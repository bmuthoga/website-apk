function MediumEditor(e,t){"use strict";return this.init(e,t)}angular.module("RecursionHelper",[]).factory("RecursionHelper",["$compile",function(e){return{compile:function(t,n){angular.isFunction(n)&&(n={post:n});var r,o=t.contents().remove();return{pre:n&&n.pre?n.pre:null,post:function(t,i){r||(r=e(o)),r(t,function(e){i.append(e)}),n&&n.post&&n.post.apply(null,arguments)}}}}}]),function(e,t){"use strict";function n(){this.$get=["$$sanitizeUri",function(e){return function(t){var n=[];return i(t,u(n,function(t,n){return!/^unsafe/.test(e(t,n))})),n.join("")}}]}function r(e){var n=[],r=u(n,t.noop);return r.chars(e),n.join("")}function o(e){var t,n={},r=e.split(",");for(t=0;t<r.length;t++)n[r[t]]=!0;return n}function i(e,n){function r(e,r,i,s){if(r=t.lowercase(r),k[r])for(;_.last()&&x[_.last()];)o("",_.last());S[r]&&_.last()==r&&o("",r),s=b[r]||!!s,s||_.push(r);var u={};i.replace(p,function(e,t,n,r,o){var i=n||r||o||"";u[t]=a(i)}),n.start&&n.start(r,u,s)}function o(e,r){var o,i=0;if(r=t.lowercase(r))for(i=_.length-1;i>=0&&_[i]!=r;i--);if(i>=0){for(o=_.length-1;o>=i;o--)n.end&&n.end(_[o]);_.length=i}}var i,s,u,_=[],y=e;for(_.last=function(){return _[_.length-1]};e;){if(s=!0,_.last()&&C[_.last()])e=e.replace(new RegExp("(.*)<\\s*\\/\\s*"+_.last()+"[^>]*>","i"),function(e,t){return t=t.replace(m,"$1").replace(g,"$1"),n.chars&&n.chars(a(t)),""}),o("",_.last());else if(0===e.indexOf("<!--")?(i=e.indexOf("--",4),i>=0&&e.lastIndexOf("-->",i)===i&&(n.comment&&n.comment(e.substring(4,i)),e=e.substring(i+3),s=!1)):v.test(e)?(u=e.match(v),u&&(e=e.replace(u[0],""),s=!1)):h.test(e)?(u=e.match(d),u&&(e=e.substring(u[0].length),u[0].replace(d,o),s=!1)):f.test(e)&&(u=e.match(l),u&&(e=e.substring(u[0].length),u[0].replace(l,r),s=!1)),s){i=e.indexOf("<");var w=0>i?e:e.substring(0,i);e=0>i?"":e.substring(i),n.chars&&n.chars(a(w))}if(e==y)throw c("badparse","The sanitizer was unable to parse the following block of html: {0}",e);y=e}o()}function a(e){if(!e)return"";var t=L.exec(e),n=t[1],r=t[3],o=t[2];return o&&(O.innerHTML=o.replace(/</g,"&lt;"),o="textContent"in O?O.textContent:O.innerText),n+o+r}function s(e){return e.replace(/&/g,"&amp;").replace(_,function(e){return"&#"+e.charCodeAt(0)+";"}).replace(/</g,"&lt;").replace(/>/g,"&gt;")}function u(e,n){var r=!1,o=t.bind(e,e.push);return{start:function(e,i,a){e=t.lowercase(e),!r&&C[e]&&(r=e),r||E[e]!==!0||(o("<"),o(e),t.forEach(i,function(r,i){var a=t.lowercase(i),u="img"===e&&"src"===a||"background"===a;A[a]!==!0||T[a]===!0&&!n(r,u)||(o(" "),o(i),o('="'),o(s(r)),o('"'))}),o(a?"/>":">"))},end:function(e){e=t.lowercase(e),r||E[e]!==!0||(o("</"),o(e),o(">")),e==r&&(r=!1)},chars:function(e){r||o(s(e))}}}var c=t.$$minErr("$sanitize"),l=/^<\s*([\w:-]+)((?:\s+[\w:-]+(?:\s*=\s*(?:(?:"[^"]*")|(?:'[^']*')|[^>\s]+))?)*)\s*(\/?)\s*>/,d=/^<\s*\/\s*([\w:-]+)[^>]*>/,p=/([\w:-]+)(?:\s*=\s*(?:(?:"((?:[^"])*)")|(?:'((?:[^'])*)')|([^>\s]+)))?/g,f=/^</,h=/^<\s*\//,m=/<!--(.*?)-->/g,v=/<!DOCTYPE([^>]*?)>/i,g=/<!\[CDATA\[(.*?)]]>/g,_=/([^\#-~| |!])/g,b=o("area,br,col,hr,img,wbr"),y=o("colgroup,dd,dt,li,p,tbody,td,tfoot,th,thead,tr"),w=o("rp,rt"),S=t.extend({},w,y),k=t.extend({},y,o("address,article,aside,blockquote,caption,center,del,dir,div,dl,figure,figcaption,footer,h1,h2,h3,h4,h5,h6,header,hgroup,hr,ins,map,menu,nav,ol,pre,script,section,table,ul")),x=t.extend({},w,o("a,abbr,acronym,b,bdi,bdo,big,br,cite,code,del,dfn,em,font,i,img,ins,kbd,label,map,mark,q,ruby,rp,rt,s,samp,small,span,strike,strong,sub,sup,time,tt,u,var")),C=o("script,style"),E=t.extend({},b,k,x,S),T=o("background,cite,href,longdesc,src,usemap"),A=t.extend({},T,o("abbr,align,alt,axis,bgcolor,border,cellpadding,cellspacing,class,clear,color,cols,colspan,compact,coords,dir,face,headers,height,hreflang,hspace,ismap,lang,language,nohref,nowrap,rel,rev,rows,rowspan,rules,scope,scrolling,shape,size,span,start,summary,target,title,type,valign,value,vspace,width")),O=document.createElement("pre"),L=/^(\s*)([\s\S]*?)(\s*)$/;t.module("ngSanitize",[]).provider("$sanitize",n),t.module("ngSanitize").filter("linky",["$sanitize",function(e){var n=/((ftp|https?):\/\/|(mailto:)?[A-Za-z0-9._%+-]+@)\S*[^\s.;,(){}<>]/,o=/^mailto:/;return function(i,a){function s(e){e&&f.push(r(e))}function u(e,n){f.push("<a "),t.isDefined(a)&&(f.push('target="'),f.push(a),f.push('" ')),f.push('href="'),f.push(e),f.push('">'),s(n),f.push("</a>")}if(!i)return i;for(var c,l,d,p=i,f=[];c=p.match(n);)l=c[0],c[2]==c[3]&&(l="mailto:"+l),d=c.index,s(p.substr(0,d)),u(l,c[0].replace(o,"")),p=p.substring(d+c[0].length);return s(p),e(f.join(""))}}])}(window,window.angular),function(){var e=angular.module("angularFileUpload",[]);e.service("$upload",["$http","$timeout",function(e,t){function n(n){n.method=n.method||"POST",n.headers=n.headers||{},n.transformRequest=n.transformRequest||function(t,n){return window.ArrayBuffer&&t instanceof window.ArrayBuffer?t:e.defaults.transformRequest[0](t,n)},window.XMLHttpRequest.__isShim&&(n.headers.__setXHR_=function(){return function(e){n.__XHR=e,n.xhrFn&&n.xhrFn(e),e.upload.addEventListener("progress",function(e){n.progress&&t(function(){n.progress&&n.progress(e)})},!1),e.upload.addEventListener("load",function(e){e.lengthComputable&&t(function(){n.progress&&n.progress(e)})},!1)}});var r=e(n);return r.progress=function(e){return n.progress=e,r},r.abort=function(){return n.__XHR&&t(function(){n.__XHR.abort()}),r},r.xhr=function(e){return n.xhrFn=e,r},r.then=function(e,t){return function(r,o,i){n.progress=i||n.progress;var a=t.apply(e,[r,o,i]);return a.abort=e.abort,a.progress=e.progress,a.xhr=e.xhr,a}}(r,r.then),r}this.upload=function(t){t.headers=t.headers||{},t.headers["Content-Type"]=void 0,t.transformRequest=t.transformRequest||e.defaults.transformRequest;var r=new FormData,o=t.transformRequest,i=t.data;return t.transformRequest=function(e,n){if(i)if(t.formDataAppender)for(var r in i){var a=i[r];t.formDataAppender(e,r,a)}else for(var r in i){var a=i[r];if("function"==typeof o)a=o(a,n);else for(var s=0;s<o.length;s++){var u=o[s];"function"==typeof u&&(a=u(a,n))}e.append(r,a)}if(null!=t.file){var c=t.fileFormDataName||"file";if("[object Array]"===Object.prototype.toString.call(t.file))for(var l="[object String]"===Object.prototype.toString.call(c),s=0;s<t.file.length;s++)e.append(l?c+s:c[s],t.file[s],t.file[s].name);else e.append(c,t.file,t.file.name)}return e},t.data=r,n(t)},this.http=function(e){return n(e)}}]),e.directive("ngFileSelect",["$parse","$timeout",function(e,t){return function(n,r,o){var i=e(o.ngFileSelect);r.bind("change",function(e){var r,o,a=[];if(r=e.target.files,null!=r)for(o=0;o<r.length;o++)a.push(r.item(o));t(function(){i(n,{$files:a,$event:e})})}),r.bind("click",function(){this.value=null})}}]),e.directive("ngFileDropAvailable",["$parse","$timeout",function(e,t){return function(n,r,o){if("draggable"in document.createElement("span")){var i=e(o.ngFileDropAvailable);t(function(){i(n)})}}}]),e.directive("ngFileDrop",["$parse","$timeout",function(e,t){return function(n,r,o){function i(e,t){if(t.isDirectory){var n=t.createReader();u++,n.readEntries(function(t){for(var n=0;n<t.length;n++)i(e,t[n]);u--})}else u++,t.file(function(t){u--,e.push(t)})}if("draggable"in document.createElement("span")){var a=null,s=e(o.ngFileDrop);r[0].addEventListener("dragover",function(e){t.cancel(a),e.stopPropagation(),e.preventDefault(),r.addClass(o.ngFileDragOverClass||"dragover")},!1),r[0].addEventListener("dragleave",function(){a=t(function(){r.removeClass(o.ngFileDragOverClass||"dragover")})},!1);var u=0;r[0].addEventListener("drop",function(e){e.stopPropagation(),e.preventDefault(),r.removeClass(o.ngFileDragOverClass||"dragover");var a=[],c=e.dataTransfer.items;if(c&&c.length>0&&c[0].webkitGetAsEntry)for(var l=0;l<c.length;l++)i(a,c[l].webkitGetAsEntry());else{var d=e.dataTransfer.files;if(null!=d)for(var l=0;l<d.length;l++)a.push(d.item(l))}!function p(r){t(function(){u?p(10):s(n,{$files:a,$event:e})},r||0)}()},!1)}}}])}(),function(){var e=function(){try{var e=new ActiveXObject("ShockwaveFlash.ShockwaveFlash");if(e)return!0}catch(t){if(void 0!=navigator.mimeTypes["application/x-shockwave-flash"])return!0}return!1};if(window.XMLHttpRequest&&(window.FormData?window.XMLHttpRequest=function(e){return function(){var t=new e;return t.setRequestHeader=function(e){return function(n,r){if("__setXHR_"===n){var o=r(t);o instanceof Function&&o(t)}else e.apply(t,arguments)}}(t.setRequestHeader),t}}(window.XMLHttpRequest):(window.XMLHttpRequest=function(t){return function(){var n=new t,r=n.send;return n.__requestHeaders=[],n.open=function(e){return n.upload||(n.upload={}),n.__listeners=[],n.upload.addEventListener=function(e,t){n.__listeners[e]=t},function(t,r,o){e.apply(n,[t,r,o]),n.__url=r}}(n.open),n.getResponseHeader=function(e){return function(t){return n.__fileApiXHR?n.__fileApiXHR.getResponseHeader(t):e.apply(n,[t])}}(n.getResponseHeader),n.getAllResponseHeaders=function(e){return function(){return n.__fileApiXHR?n.__fileApiXHR.getAllResponseHeaders():e.apply(n)}}(n.getAllResponseHeaders),n.abort=function(e){return function(){return n.__fileApiXHR?n.__fileApiXHR.abort():null==e?null:e.apply(n)}}(n.abort),n.setRequestHeader=function(e){return function(t,r){if("__setXHR_"===t){var o=r(n);o instanceof Function&&o(n)}else e.apply(n,arguments)}}(n.setRequestHeader),n.send=function(){if(arguments[0]&&arguments[0].__isShim){var t=arguments[0],o={url:n.__url,complete:function(e,t){!e&&n.__listeners.load&&n.__listeners.load({type:"load",loaded:n.__loaded,total:n.__total,target:n,lengthComputable:!0}),!e&&n.__listeners.loadend&&n.__listeners.loadend({type:"loadend",loaded:n.__loaded,total:n.__total,target:n,lengthComputable:!0}),"abort"===e&&n.__listeners.abort&&n.__listeners.abort({type:"abort",loaded:n.__loaded,total:n.__total,target:n,lengthComputable:!0}),void 0!==t.status&&Object.defineProperty(n,"status",{get:function(){return t.status}}),void 0!==t.statusText&&Object.defineProperty(n,"statusText",{get:function(){return t.statusText}}),Object.defineProperty(n,"readyState",{get:function(){return 4}}),void 0!==t.response&&Object.defineProperty(n,"response",{get:function(){return t.response}}),Object.defineProperty(n,"responseText",{get:function(){return t.responseText}}),n.__fileApiXHR=t,n.onreadystatechange()},progress:function(e){e.target=n,n.__listeners.progress&&n.__listeners.progress(e),n.__total=e.total,n.__loaded=e.loaded},headers:n.__requestHeaders};o.data={},o.files={};for(var i=0;i<t.data.length;i++){var a=t.data[i];null!=a.val&&null!=a.val.name&&null!=a.val.size&&null!=a.val.type?o.files[a.key]=a.val:o.data[a.key]=a.val}setTimeout(function(){if(!e())throw'Adode Flash Player need to be installed. To check ahead use "FileAPI.hasFlash"';n.__fileApiXHR=FileAPI.upload(o)},1)}else r.apply(n,arguments)},n}}(window.XMLHttpRequest),window.XMLHttpRequest.__hasFlash=e()),window.XMLHttpRequest.__isShim=!0),!window.FormData){var t=function(t){if(!e())throw'Adode Flash Player need to be installed. To check ahead use "FileAPI.hasFlash"';if(!t.__isWrapped&&(null!=t.getAttribute("ng-file-select")||null!=t.getAttribute("data-ng-file-select"))){var n=document.createElement("div");n.innerHTML='<div class="js-fileapi-wrapper" style="position:relative; overflow:hidden"></div>',n=n.firstChild;var r=t.parentNode;r.insertBefore(n,t),r.removeChild(t),n.appendChild(t),t.__isWrapped=!0}},n=function(e){return function(t){var n=FileAPI.getFiles(t);t.target||(t.target={}),t.target.files=n,t.target.files.item=function(e){return t.target.files[e]||null},e(t)}},r=function(e,t){return("change"===t.toLowerCase()||"onchange"===t.toLowerCase())&&"file"==e.getAttribute("type")};HTMLInputElement.prototype.addEventListener&&(HTMLInputElement.prototype.addEventListener=function(e){return function(o,i,a,s){r(this,o)?(t(this),e.apply(this,[o,n(i),a,s])):e.apply(this,[o,i,a,s])}}(HTMLInputElement.prototype.addEventListener)),HTMLInputElement.prototype.attachEvent&&(HTMLInputElement.prototype.attachEvent=function(e){return function(o,i){r(this,o)?(t(this),e.apply(this,[o,n(i)])):e.apply(this,[o,i])}}(HTMLInputElement.prototype.attachEvent)),window.FormData=FormData=function(){return{append:function(e,t,n){this.data.push({key:e,val:t,name:n})},data:[],__isShim:!0}},function(){if(window.FileAPI||(window.FileAPI={}),!FileAPI.upload){var t,n,r,o,i,a=document.createElement("script"),s=document.getElementsByTagName("script");if(window.FileAPI.jsUrl)t=window.FileAPI.jsUrl;else if(window.FileAPI.jsPath)n=window.FileAPI.jsPath;else for(r=0;r<s.length;r++)if(i=s[r].src,o=i.indexOf("angular-file-upload-shim.js"),-1==o&&(o=i.indexOf("angular-file-upload-shim.min.js")),o>-1){n=i.substring(0,o);break}null==FileAPI.staticPath&&(FileAPI.staticPath=n),a.setAttribute("src",t||n+"FileAPI.min.js"),document.getElementsByTagName("head")[0].appendChild(a),FileAPI.hasFlash=e()}}()}window.FileReader||(window.FileReader=function(){function e(e,n){var r={type:e,target:t,loaded:n.loaded,total:n.total,error:n.error};return null!=n.result&&(r.target.result=n.result),r}var t=this,n=!1;this.listeners={},this.addEventListener=function(e,n){t.listeners[e]=t.listeners[e]||[],t.listeners[e].push(n)},this.removeEventListener=function(e,n){t.listeners[e]&&t.listeners[e].splice(t.listeners[e].indexOf(n),1)},this.dispatchEvent=function(e){var n=t.listeners[e.type];if(n)for(var r=0;r<n.length;r++)n[r].call(t,e)},this.onabort=this.onerror=this.onload=this.onloadstart=this.onloadend=this.onprogress=null;var r=function(r){if(n||(n=!0,t.onloadstart&&this.onloadstart(e("loadstart",r))),"load"===r.type){t.onloadend&&t.onloadend(e("loadend",r));var o=e("load",r);t.onload&&t.onload(o),t.dispatchEvent(o)}else if("progress"===r.type){var o=e("progress",r);t.onprogress&&t.onprogress(o),t.dispatchEvent(o)}else{var o=e("error",r);t.onerror&&t.onerror(o),t.dispatchEvent(o)}};this.readAsArrayBuffer=function(e){FileAPI.readAsBinaryString(e,r)},this.readAsBinaryString=function(e){FileAPI.readAsBinaryString(e,r)},this.readAsDataURL=function(e){FileAPI.readAsDataURL(e,r)},this.readAsText=function(e){FileAPI.readAsText(e,r)}})}(),angular.module("mnd.multi-transclude",[]).directive("mndMultiTransclude",function(){return{link:function(e,t,n,r,o){if(!o)throw new Error("Illegal use of mndMultiTransculde");o(function(e){var r=angular.element("<div></div>");r.append(e);var o="[name="+n.mndMultiTransclude+"]",i=r[0].querySelector(o);i=angular.element(i),t.replaceWith(i)})}}}),angular.module("mnd.dashboard",["ui.bootstrap","mnd.multi-transclude"]).factory("MndSidebarService",function(){var e=!1;return{getSidebarStatus:function(){return e},toggleSidebarStatus:function(){e=!e}}}).directive("mndSidebar",["MndSidebarService",function(e){return{restrict:"EA",templateUrl:"template/sidebar.html",replace:!0,transclude:!0,scope:!0,link:function(t){t.call=function(e){if(e){var n=Array.prototype.slice.call(arguments,1);t.actions[e].apply(null,n)}},t.isSubmenu=function(e){return"submenu"===e.type},t.toggleSubmenu=function(e){"submenu"===e.type&&(e.open=!e.open)},t.sidebarOpen=e.getSidebarStatus(),t.$on("sidebarStatusChanged",function(){t.sidebarOpen=e.getSidebarStatus()})}}}]).directive("mndToggleSidebar",["MndSidebarService",function(e){return{restrict:"EA",templateUrl:"template/toggle-sidebar.html",replace:!0,transclude:!0,scope:!0,link:function(t){t.sidebarOpen=e.getSidebarStatus(),t.toggle=function(){e.toggleSidebarStatus(),t.$parent.$broadcast("sidebarStatusChanged")},t.$on("sidebarStatusChanged",function(){t.sidebarOpen=e.getSidebarStatus()})}}}]).directive("mndContent",["MndSidebarService",function(e){return{restrict:"EA",templateUrl:"template/content.html",replace:!0,transclude:!0,scope:!0,link:function(t){t.sidebarOpen=e.getSidebarStatus(),t.$on("sidebarStatusChanged",function(){t.sidebarOpen=e.getSidebarStatus()})}}}]),function(e){try{e=angular.module("mnd.dashboard")}catch(t){e=angular.module("mnd.dashboard",[])}e.run(["$templateCache",function(e){e.put("template/content.html",'<div id="mnd-content" ng-class="{\'sidebar-open\': sidebarOpen}" ng-transclude></div>\n')}])}(),function(e){try{e=angular.module("mnd.dashboard")}catch(t){e=angular.module("mnd.dashboard",[])}e.run(["$templateCache",function(e){e.put("template/sidebar.html",'<div id="mnd-sidebar" ng-class="{\'sidebar-open\': sidebarOpen}">\n	<div mnd-multi-transclude="before"></div>\n	<ul class="nav">\n		<li ng-repeat="item in menu.items" ng-click="toggleSubmenu(item)" class="mnd-clickable">\n\n			<a ng-if="item.type === \'link\'" ng-href="{{item.link}}">\n				{{item.title}}\n			</a>\n\n			<a ng-if="item.type === \'action\'" ng-click="call(item.action)">\n				{{item.title}}\n			</a>\n\n			<a ng-if="item.type === \'submenu\'">\n				{{item.title}}\n				<span ng-if="isSubmenu(item)" class="pull-right">\n					<i ng-if="!item.open" class="fa fa-angle-left"></i>\n					<i ng-if="item.open" class="fa fa-angle-down"></i>\n				</span>\n			</a>\n\n			<ul ng-if="isSubmenu(item)" collapse="!item.open" class="nav nav-second-level">\n				<li ng-repeat="subitem in item.items">\n					<a ng-href="{{subitem.link}}" ng-click="call(subitem.action)">\n						<span class="mnd-width-20"></span>\n						<span class="mnd-width-20" ng-if="subitem.icon">\n							<i class="fa {{subitem.icon}}"></i>\n						</span>\n						{{subitem.title}}\n					</a>\n				</li>\n			</ul>\n		</li>\n	</ul>\n	<div mnd-multi-transclude="after"></div>\n</div>\n')}])}(),function(e){try{e=angular.module("mnd.dashboard")}catch(t){e=angular.module("mnd.dashboard",[])}e.run(["$templateCache",function(e){e.put("template/toggle-sidebar.html",'<div id="mnd-toggle-sidebar" ng-class="{\'sidebar-open\': sidebarOpen}">\n	<div id="mnd-show-sidebar" ng-click="toggle()">\n		<i class="fa fa-bars" ng-show="!sidebarOpen"></i>\n		<i class="fa fa-times" ng-show="sidebarOpen"></i>\n	</div>\n	<div mnd-multi-transclude="center"></div>\n</div>\n')}])}(),angular.module("mnd.sprinkle",[]).factory("MndWordProcessingService",function(){return function(e){var t={};if(2===e.length)t.left=e[0],t.pivot=e[1],t.right="";else{var n=Math.ceil(e.length/2-1);t.left=e.slice(0,n),t.right=e.slice(n+1),t.pivot=e.slice(n,n+1)}return t.multiplier=/[\,\:\;]$/g.test(e)?1.5:/[\.\!\?]$/g.test(e)?2:1,t}}).factory("MndWordSplittingService",function(){return function(e){var t=e.split(" ");return t}}).factory("MndTagStrippingService",function(){return function(e){var t=e.replace(/(<([^>]+)>)/gi," ");t=t.replace(/\s+/g," ").trim();var n=document.createElement("p");return n.innerHTML=t,n.textContent}}).factory("MndReadTimeEstimatingService",["MndTagStrippingService",function(){return function(e,t){return Math.round(e/t)}}]).directive("mndSprinkle",["$timeout","MndWordSplittingService","MndWordProcessingService","MndTagStrippingService","MndReadTimeEstimatingService",function(e,t,n,r,o){return{restrict:"EA",templateUrl:"templates/sprinkle.html",scope:{text:"@?",html:"@?",defaultWpm:"@?",wpm:"=?",time:"=?",hideControlBar:"=?",autoplay:"@?",autoplayDelay:"@?",progressPercentage:"=?"},link:function(i){if(i.text)i._words=t(i.text);else{if(!i.html)throw new Error("Nothing to display!");i._text=r(i.html),i._words=t(i._text)}i.wpm=i.wpm||parseInt(i.defaultWpm||"250",10),i.time=o(i._words.length,i.wpm),i._msPerWord=function(){return Math.floor(6e4/i.wpm)},i.increaseSpeed=function(e){var t=i.wpm;t+=e||50,i.wpm=t,i.time=o(i._words.length,i.wpm)},i.decreaseSpeed=function(e){var t=i.wpm;t-=e||50,50>t&&(t=50),i.wpm=t,i.time=o(i._words.length,i.wpm)};var a=function(){var t=i._words[i._wordIndex],r=n(t);i.word=r;var o=r.multiplier*i._msPerWord();i._wordIndex++,i.progressPercentage=i._wordIndex/i._words.length*100,i._wordIndex<i._words.length?i._timeout=e(a,o):(i.running=!1,i._wordIndex=0)};if(i.running=!1,i._wordIndex=0,i.start=function(){i.running||(i.running=!0,a())},i.pause=function(){i.running&&(e.cancel(i._timeout),i.running=!1)},i.toggle=function(){i.running?i.pause():i.start()},i.rewind=function(){i._wordIndex=0},i.stop=function(){i.pause(),i.rewind()},"true"===i.autoplay){var s=parseInt(i.autoplayDelay,10),u=isNaN(s)?0:s;e(function(){i.start()},1e3*u)}i.toggleControlBar=function(){i.hideControlBar=!i.hideControlBar}}}}]),function(e){try{e=angular.module("mnd.sprinkle")}catch(t){e=angular.module("mnd.sprinkle",[])}e.run(["$templateCache",function(e){e.put("templates/sprinkle.html",'<div class="sprinkle-container">\n	<div class="sprinkle-result" ng-click="toggle();">\n		<span class="sprinkle-left">\n			&nbsp;\n			{{word.left}}\n		</span>\n		<span class="sprinkle-pivot">\n			<div class="sprinkle-center-line-top"></div>\n			<div class="sprinkle-center-line-bottom"></div>	\n			{{word.pivot || "&nbsp;"}}\n		</span>\n		<span class="sprinkle-right">\n			{{word.right}}\n		</span>\n	</div>\n	<div class="sprinkle-control-bar" ng-if="!hideControlBar">\n		<div class="sprinkle-control-bar-left">\n			<div class="sprinkle-control-btn" ng-click="rewind()"><i class="fa fa-refresh"></i></div>\n			<div class="sprinkle-control-btn" ng-if="running" ng-click="pause()"><i class="fa fa-pause"></i></div>\n			<div class="sprinkle-control-btn" ng-if="!running" ng-click="start()"><i class="fa fa-play"></i></div>\n		</div>\n		<div class="sprinkle-control-bar-right">\n			<div class="sprinkle-control-btn" ng-click="decreaseSpeed()"><i class="fa fa-minus"></i></div>\n			<div class="sprinkle-control-wpm">{{wpm}} wpm </div>\n			<div class="sprinkle-control-btn" ng-click="increaseSpeed()"><i class="fa fa-plus"></i></div>\n		</div>\n	</div>\n</div>\n')}])}();var JSON;JSON||(JSON={}),function(){function str(e,t){var n,r,o,i,a,s=gap,u=t[e];switch(u&&"object"==typeof u&&"function"==typeof u.toJSON&&(u=u.toJSON(e)),"function"==typeof rep&&(u=rep.call(t,e,u)),typeof u){case"string":return quote(u);case"number":return isFinite(u)?String(u):"null";case"boolean":case"null":return String(u);case"object":if(!u)return"null";if(gap+=indent,a=[],"[object Array]"===Object.prototype.toString.apply(u)){for(i=u.length,n=0;i>n;n+=1)a[n]=str(n,u)||"null";return o=0===a.length?"[]":gap?"[\n"+gap+a.join(",\n"+gap)+"\n"+s+"]":"["+a.join(",")+"]",gap=s,o}if(rep&&"object"==typeof rep)for(i=rep.length,n=0;i>n;n+=1)"string"==typeof rep[n]&&(r=rep[n],o=str(r,u),o&&a.push(quote(r)+(gap?": ":":")+o));else for(r in u)Object.prototype.hasOwnProperty.call(u,r)&&(o=str(r,u),o&&a.push(quote(r)+(gap?": ":":")+o));return o=0===a.length?"{}":gap?"{\n"+gap+a.join(",\n"+gap)+"\n"+s+"}":"{"+a.join(",")+"}",gap=s,o}}function quote(e){return escapable.lastIndex=0,escapable.test(e)?'"'+e.replace(escapable,function(e){var t=meta[e];return"string"==typeof t?t:"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+e+'"'}function f(e){return 10>e?"0"+e:e}"function"!=typeof Date.prototype.toJSON&&(Date.prototype.toJSON=function(){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(){return this.valueOf()});var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;"function"!=typeof JSON.stringify&&(JSON.stringify=function(e,t,n){var r;if(gap="",indent="","number"==typeof n)for(r=0;n>r;r+=1)indent+=" ";else"string"==typeof n&&(indent=n);if(rep=t,!t||"function"==typeof t||"object"==typeof t&&"number"==typeof t.length)return str("",{"":e});throw new Error("JSON.stringify")}),"function"!=typeof JSON.parse&&(JSON.parse=function(text,reviver){function walk(e,t){var n,r,o=e[t];if(o&&"object"==typeof o)for(n in o)Object.prototype.hasOwnProperty.call(o,n)&&(r=walk(o,n),void 0!==r?o[n]=r:delete o[n]);return reviver.call(e,t,o)}var j;if(text=String(text),cx.lastIndex=0,cx.test(text)&&(text=text.replace(cx,function(e){return"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)})),/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return j=eval("("+text+")"),"function"==typeof reviver?walk({"":j},""):j;throw new SyntaxError("JSON.parse")})}(),SockJS=function(){var e=document,t=window,n={},r=function(){};r.prototype.addEventListener=function(e,t){this._listeners||(this._listeners={}),e in this._listeners||(this._listeners[e]=[]);var r=this._listeners[e];-1===n.arrIndexOf(r,t)&&r.push(t)},r.prototype.removeEventListener=function(e,t){if(this._listeners&&e in this._listeners){var r=this._listeners[e],o=n.arrIndexOf(r,t);return-1!==o?void(r.length>1?this._listeners[e]=r.slice(0,o).concat(r.slice(o+1)):delete this._listeners[e]):void 0}},r.prototype.dispatchEvent=function(e){var t=e.type,n=Array.prototype.slice.call(arguments,0);if(this["on"+t]&&this["on"+t].apply(this,n),this._listeners&&t in this._listeners)for(var r=0;r<this._listeners[t].length;r++)this._listeners[t][r].apply(this,n)};var o=function(e,t){if(this.type=e,"undefined"!=typeof t)for(var n in t)t.hasOwnProperty(n)&&(this[n]=t[n])};o.prototype.toString=function(){var e=[];for(var t in this)if(this.hasOwnProperty(t)){var n=this[t];"function"==typeof n&&(n="[function]"),e.push(t+"="+n)}return"SimpleEvent("+e.join(", ")+")"};var i=function(e){var t=this;t._events=e||[],t._listeners={}};i.prototype.emit=function(e){var t=this;if(t._verifyType(e),!t._nuked){var n=Array.prototype.slice.call(arguments,1);if(t["on"+e]&&t["on"+e].apply(t,n),e in t._listeners)for(var r=0;r<t._listeners[e].length;r++)t._listeners[e][r].apply(t,n)}},i.prototype.on=function(e,t){var n=this;n._verifyType(e),n._nuked||(e in n._listeners||(n._listeners[e]=[]),n._listeners[e].push(t))},i.prototype._verifyType=function(e){var t=this;-1===n.arrIndexOf(t._events,e)&&n.log("Event "+JSON.stringify(e)+" not listed "+JSON.stringify(t._events)+" in "+t)},i.prototype.nuke=function(){var e=this;e._nuked=!0;for(var t=0;t<e._events.length;t++)delete e[e._events[t]];e._listeners={}};var a="abcdefghijklmnopqrstuvwxyz0123456789_";n.random_string=function(e,t){t=t||a.length;var n,r=[];for(n=0;e>n;n++)r.push(a.substr(Math.floor(Math.random()*t),1));return r.join("")},n.random_number=function(e){return Math.floor(Math.random()*e)},n.random_number_string=function(e){var t=(""+(e-1)).length,r=Array(t+1).join("0");return(r+n.random_number(e)).slice(-t)},n.getOrigin=function(e){e+="/";var t=e.split("/").slice(0,3);return t.join("/")},n.isSameOriginUrl=function(e,n){return n||(n=t.location.href),e.split("/").slice(0,3).join("/")===n.split("/").slice(0,3).join("/")},n.getParentDomain=function(e){if(/^[0-9.]*$/.test(e))return e;if(/^\[/.test(e))return e;if(!/[.]/.test(e))return e;var t=e.split(".").slice(1);return t.join(".")},n.objectExtend=function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n]);return e};var s="_jp";n.polluteGlobalNamespace=function(){s in t||(t[s]={})},n.closeFrame=function(e,t){return"c"+JSON.stringify([e,t])},n.userSetCode=function(e){return 1e3===e||e>=3e3&&4999>=e},n.countRTO=function(e){var t;return t=e>100?3*e:e+200},n.log=function(){t.console&&console.log&&console.log.apply&&console.log.apply(console,arguments)},n.bind=function(e,t){return e.bind?e.bind(t):function(){return e.apply(t,arguments)}},n.flatUrl=function(e){return-1===e.indexOf("?")&&-1===e.indexOf("#")},n.amendUrl=function(t){var r=e.location;if(!t)throw new Error("Wrong url for SockJS");if(!n.flatUrl(t))throw new Error("Only basic urls are supported in SockJS");return 0===t.indexOf("//")&&(t=r.protocol+t),0===t.indexOf("/")&&(t=r.protocol+"//"+r.host+t),t=t.replace(/[/]+$/,"")},n.arrIndexOf=function(e,t){for(var n=0;n<e.length;n++)if(e[n]===t)return n;return-1},n.arrSkip=function(e,t){var r=n.arrIndexOf(e,t);if(-1===r)return e.slice();var o=e.slice(0,r);return o.concat(e.slice(r+1))},n.isArray=Array.isArray||function(e){return{}.toString.call(e).indexOf("Array")>=0},n.delay=function(e,t){return"function"==typeof e&&(t=e,e=0),setTimeout(t,e)};var u,c=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,l={"\x00":"\\u0000","":"\\u0001","":"\\u0002","":"\\u0003","":"\\u0004","":"\\u0005","":"\\u0006","":"\\u0007","\b":"\\b","	":"\\t","\n":"\\n","":"\\u000b","\f":"\\f","\r":"\\r","":"\\u000e","":"\\u000f","":"\\u0010","":"\\u0011","":"\\u0012","":"\\u0013","":"\\u0014","":"\\u0015","":"\\u0016","":"\\u0017","":"\\u0018","":"\\u0019","":"\\u001a","":"\\u001b","":"\\u001c","":"\\u001d","":"\\u001e","":"\\u001f",'"':'\\"',"\\":"\\\\","":"\\u007f","Â€":"\\u0080","Â":"\\u0081","Â‚":"\\u0082","Âƒ":"\\u0083","Â„":"\\u0084","Â…":"\\u0085","Â†":"\\u0086","Â‡":"\\u0087","Âˆ":"\\u0088","Â‰":"\\u0089","ÂŠ":"\\u008a","Â‹":"\\u008b","ÂŒ":"\\u008c","Â":"\\u008d","ÂŽ":"\\u008e","Â":"\\u008f","Â":"\\u0090","Â‘":"\\u0091","Â’":"\\u0092","Â“":"\\u0093","Â”":"\\u0094","Â•":"\\u0095","Â–":"\\u0096","Â—":"\\u0097","Â˜":"\\u0098","Â™":"\\u0099","Âš":"\\u009a","Â›":"\\u009b","Âœ":"\\u009c","Â":"\\u009d","Âž":"\\u009e","ÂŸ":"\\u009f","Â­":"\\u00ad","Ø€":"\\u0600","Ø":"\\u0601","Ø‚":"\\u0602","Øƒ":"\\u0603","Ø„":"\\u0604","Ü":"\\u070f","áž´":"\\u17b4","ážµ":"\\u17b5","â€Œ":"\\u200c","â€":"\\u200d","â€Ž":"\\u200e","â€":"\\u200f","\u2028":"\\u2028","\u2029":"\\u2029","â€ª":"\\u202a","â€«":"\\u202b","â€¬":"\\u202c","â€­":"\\u202d","â€®":"\\u202e","â€¯":"\\u202f","â ":"\\u2060","â¡":"\\u2061","â¢":"\\u2062","â£":"\\u2063","â¤":"\\u2064","â¥":"\\u2065","â¦":"\\u2066","â§":"\\u2067","â¨":"\\u2068","â©":"\\u2069","âª":"\\u206a","â«":"\\u206b","â¬":"\\u206c","â­":"\\u206d","â®":"\\u206e","â¯":"\\u206f","ï»¿":"\\ufeff","ï¿°":"\\ufff0","ï¿±":"\\ufff1","ï¿²":"\\ufff2","ï¿³":"\\ufff3","ï¿´":"\\ufff4","ï¿µ":"\\ufff5","ï¿¶":"\\ufff6","ï¿·":"\\ufff7","ï¿¸":"\\ufff8","ï¿¹":"\\ufff9","ï¿º":"\\ufffa","ï¿»":"\\ufffb","ï¿¼":"\\ufffc","ï¿½":"\\ufffd","ï¿¾":"\\ufffe","ï¿¿":"\\uffff"},d=/[\x00-\x1f\ud800-\udfff\ufffe\uffff\u0300-\u0333\u033d-\u0346\u034a-\u034c\u0350-\u0352\u0357-\u0358\u035c-\u0362\u0374\u037e\u0387\u0591-\u05af\u05c4\u0610-\u0617\u0653-\u0654\u0657-\u065b\u065d-\u065e\u06df-\u06e2\u06eb-\u06ec\u0730\u0732-\u0733\u0735-\u0736\u073a\u073d\u073f-\u0741\u0743\u0745\u0747\u07eb-\u07f1\u0951\u0958-\u095f\u09dc-\u09dd\u09df\u0a33\u0a36\u0a59-\u0a5b\u0a5e\u0b5c-\u0b5d\u0e38-\u0e39\u0f43\u0f4d\u0f52\u0f57\u0f5c\u0f69\u0f72-\u0f76\u0f78\u0f80-\u0f83\u0f93\u0f9d\u0fa2\u0fa7\u0fac\u0fb9\u1939-\u193a\u1a17\u1b6b\u1cda-\u1cdb\u1dc0-\u1dcf\u1dfc\u1dfe\u1f71\u1f73\u1f75\u1f77\u1f79\u1f7b\u1f7d\u1fbb\u1fbe\u1fc9\u1fcb\u1fd3\u1fdb\u1fe3\u1feb\u1fee-\u1fef\u1ff9\u1ffb\u1ffd\u2000-\u2001\u20d0-\u20d1\u20d4-\u20d7\u20e7-\u20e9\u2126\u212a-\u212b\u2329-\u232a\u2adc\u302b-\u302c\uaab2-\uaab3\uf900-\ufa0d\ufa10\ufa12\ufa15-\ufa1e\ufa20\ufa22\ufa25-\ufa26\ufa2a-\ufa2d\ufa30-\ufa6d\ufa70-\ufad9\ufb1d\ufb1f\ufb2a-\ufb36\ufb38-\ufb3c\ufb3e\ufb40-\ufb41\ufb43-\ufb44\ufb46-\ufb4e\ufff0-\uffff]/g,p=JSON&&JSON.stringify||function(e){return c.lastIndex=0,c.test(e)&&(e=e.replace(c,function(e){return l[e]})),'"'+e+'"'},f=function(e){var t,n={},r=[];for(t=0;65536>t;t++)r.push(String.fromCharCode(t));return e.lastIndex=0,r.join("").replace(e,function(e){return n[e]="\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4),""}),e.lastIndex=0,n};n.quote=function(e){var t=p(e);return d.lastIndex=0,d.test(t)?(u||(u=f(d)),t.replace(d,function(e){return u[e]})):t};var h=["websocket","xdr-streaming","xhr-streaming","iframe-eventsource","iframe-htmlfile","xdr-polling","xhr-polling","iframe-xhr-polling","jsonp-polling"];n.probeProtocols=function(){for(var e={},t=0;t<h.length;t++){var n=h[t];e[n]=x[n]&&x[n].enabled()}return e},n.detectProtocols=function(e,t,n){var r={},o=[];t||(t=h);for(var i=0;i<t.length;i++){var a=t[i];r[a]=e[a]}var s=function(e){var t=e.shift();r[t]?o.push(t):e.length>0&&s(e)};return n.websocket!==!1&&s(["websocket"]),r["xhr-streaming"]&&!n.null_origin?o.push("xhr-streaming"):!r["xdr-streaming"]||n.cookie_needed||n.null_origin?s(["iframe-eventsource","iframe-htmlfile"]):o.push("xdr-streaming"),r["xhr-polling"]&&!n.null_origin?o.push("xhr-polling"):!r["xdr-polling"]||n.cookie_needed||n.null_origin?s(["iframe-xhr-polling","jsonp-polling"]):o.push("xdr-polling"),o
};var m="_sockjs_global";n.createHook=function(){var e="a"+n.random_string(8);if(!(m in t)){var r={};t[m]=function(e){return e in r||(r[e]={id:e,del:function(){delete r[e]}}),r[e]}}return t[m](e)},n.attachMessage=function(e){n.attachEvent("message",e)},n.attachEvent=function(n,r){"undefined"!=typeof t.addEventListener?t.addEventListener(n,r,!1):(e.attachEvent("on"+n,r),t.attachEvent("on"+n,r))},n.detachMessage=function(e){n.detachEvent("message",e)},n.detachEvent=function(n,r){"undefined"!=typeof t.addEventListener?t.removeEventListener(n,r,!1):(e.detachEvent("on"+n,r),t.detachEvent("on"+n,r))};var v={},g=!1,_=function(){for(var e in v)v[e](),delete v[e]},b=function(){g||(g=!0,_())};n.attachEvent("unload",b),n.unload_add=function(e){var t=n.random_string(8);return v[t]=e,g&&n.delay(_),t},n.unload_del=function(e){e in v&&delete v[e]},n.createIframe=function(t,r){var o,i,a=e.createElement("iframe"),s=function(){clearTimeout(o);try{a.onload=null}catch(e){}a.onerror=null},u=function(){a&&(s(),setTimeout(function(){a&&a.parentNode.removeChild(a),a=null},0),n.unload_del(i))},c=function(e){a&&(u(),r(e))},l=function(e,t){try{a&&a.contentWindow&&a.contentWindow.postMessage(e,t)}catch(n){}};return a.src=t,a.style.display="none",a.style.position="absolute",a.onerror=function(){c("onerror")},a.onload=function(){clearTimeout(o),o=setTimeout(function(){c("onload timeout")},2e3)},e.body.appendChild(a),o=setTimeout(function(){c("timeout")},15e3),i=n.unload_add(u),{post:l,cleanup:u,loaded:s}},n.createHtmlfile=function(e,r){var o,i,a,u=new ActiveXObject("htmlfile"),c=function(){clearTimeout(o)},l=function(){u&&(c(),n.unload_del(i),a.parentNode.removeChild(a),a=u=null,CollectGarbage())},d=function(e){u&&(l(),r(e))},p=function(e,t){try{a&&a.contentWindow&&a.contentWindow.postMessage(e,t)}catch(n){}};u.open(),u.write('<html><script>document.domain="'+document.domain+'";</script></html>'),u.close(),u.parentWindow[s]=t[s];var f=u.createElement("div");return u.body.appendChild(f),a=u.createElement("iframe"),f.appendChild(a),a.src=e,o=setTimeout(function(){d("timeout")},15e3),i=n.unload_add(l),{post:p,cleanup:l,loaded:c}};var y=function(){};y.prototype=new i(["chunk","finish"]),y.prototype._start=function(e,r,o,i){var a=this;try{a.xhr=new XMLHttpRequest}catch(s){}if(!a.xhr)try{a.xhr=new t.ActiveXObject("Microsoft.XMLHTTP")}catch(s){}(t.ActiveXObject||t.XDomainRequest)&&(r+=(-1===r.indexOf("?")?"?":"&")+"t="+ +new Date),a.unload_ref=n.unload_add(function(){a._cleanup(!0)});try{a.xhr.open(e,r,!0)}catch(u){return a.emit("finish",0,""),void a._cleanup()}if(i&&i.no_credentials||(a.xhr.withCredentials="true"),i&&i.headers)for(var c in i.headers)a.xhr.setRequestHeader(c,i.headers[c]);a.xhr.onreadystatechange=function(){if(a.xhr){var e=a.xhr;switch(e.readyState){case 3:try{var t=e.status,n=e.responseText}catch(e){}1223===t&&(t=204),n&&n.length>0&&a.emit("chunk",t,n);break;case 4:var t=e.status;1223===t&&(t=204),a.emit("finish",t,e.responseText),a._cleanup(!1)}}},a.xhr.send(o)},y.prototype._cleanup=function(e){var t=this;if(t.xhr){if(n.unload_del(t.unload_ref),t.xhr.onreadystatechange=function(){},e)try{t.xhr.abort()}catch(r){}t.unload_ref=t.xhr=null}},y.prototype.close=function(){var e=this;e.nuke(),e._cleanup(!0)};var w=n.XHRCorsObject=function(){var e=this,t=arguments;n.delay(function(){e._start.apply(e,t)})};w.prototype=new y;var S=n.XHRLocalObject=function(e,t,r){var o=this;n.delay(function(){o._start(e,t,r,{no_credentials:!0})})};S.prototype=new y;var k=n.XDRObject=function(e,t,r){var o=this;n.delay(function(){o._start(e,t,r)})};k.prototype=new i(["chunk","finish"]),k.prototype._start=function(e,t,r){var o=this,i=new XDomainRequest;t+=(-1===t.indexOf("?")?"?":"&")+"t="+ +new Date;var a=i.ontimeout=i.onerror=function(){o.emit("finish",0,""),o._cleanup(!1)};i.onprogress=function(){o.emit("chunk",200,i.responseText)},i.onload=function(){o.emit("finish",200,i.responseText),o._cleanup(!1)},o.xdr=i,o.unload_ref=n.unload_add(function(){o._cleanup(!0)});try{o.xdr.open(e,t),o.xdr.send(r)}catch(s){a()}},k.prototype._cleanup=function(e){var t=this;if(t.xdr){if(n.unload_del(t.unload_ref),t.xdr.ontimeout=t.xdr.onerror=t.xdr.onprogress=t.xdr.onload=null,e)try{t.xdr.abort()}catch(r){}t.unload_ref=t.xdr=null}},k.prototype.close=function(){var e=this;e.nuke(),e._cleanup(!0)},n.isXHRCorsCapable=function(){return t.XMLHttpRequest&&"withCredentials"in new XMLHttpRequest?1:t.XDomainRequest&&e.domain?2:H.enabled()?3:4};var x=function(e,r,o){if(this===t)return new x(e,r,o);var i,a=this;a._options={devel:!1,debug:!1,protocols_whitelist:[],info:void 0,rtt:void 0},o&&n.objectExtend(a._options,o),a._base_url=n.amendUrl(e),a._server=a._options.server||n.random_number_string(1e3),a._options.protocols_whitelist&&a._options.protocols_whitelist.length?i=a._options.protocols_whitelist:(i="string"==typeof r&&r.length>0?[r]:n.isArray(r)?r:null,i&&a._debug('Deprecated API: Use "protocols_whitelist" option instead of supplying protocol list as a second parameter to SockJS constructor.')),a._protocols=[],a.protocol=null,a.readyState=x.CONNECTING,a._ir=U(a._base_url),a._ir.onfinish=function(e,t){a._ir=null,e?(a._options.info&&(e=n.objectExtend(e,a._options.info)),a._options.rtt&&(t=a._options.rtt),a._applyInfo(e,t,i),a._didClose()):a._didClose(1002,"Can't connect to server",!0)}};x.prototype=new r,x.version="0.3.4",x.CONNECTING=0,x.OPEN=1,x.CLOSING=2,x.CLOSED=3,x.prototype._debug=function(){this._options.debug&&n.log.apply(n,arguments)},x.prototype._dispatchOpen=function(){var e=this;e.readyState===x.CONNECTING?(e._transport_tref&&(clearTimeout(e._transport_tref),e._transport_tref=null),e.readyState=x.OPEN,e.dispatchEvent(new o("open"))):e._didClose(1006,"Server lost session")},x.prototype._dispatchMessage=function(e){var t=this;t.readyState===x.OPEN&&t.dispatchEvent(new o("message",{data:e}))},x.prototype._dispatchHeartbeat=function(){var e=this;e.readyState===x.OPEN&&e.dispatchEvent(new o("heartbeat",{}))},x.prototype._didClose=function(e,t,r){var i=this;if(i.readyState!==x.CONNECTING&&i.readyState!==x.OPEN&&i.readyState!==x.CLOSING)throw new Error("INVALID_STATE_ERR");i._ir&&(i._ir.nuke(),i._ir=null),i._transport&&(i._transport.doCleanup(),i._transport=null);var a=new o("close",{code:e,reason:t,wasClean:n.userSetCode(e)});if(!n.userSetCode(e)&&i.readyState===x.CONNECTING&&!r){if(i._try_next_protocol(a))return;a=new o("close",{code:2e3,reason:"All transports failed",wasClean:!1,last_event:a})}i.readyState=x.CLOSED,n.delay(function(){i.dispatchEvent(a)})},x.prototype._didMessage=function(e){var t=this,n=e.slice(0,1);switch(n){case"o":t._dispatchOpen();break;case"a":for(var r=JSON.parse(e.slice(1)||"[]"),o=0;o<r.length;o++)t._dispatchMessage(r[o]);break;case"m":var r=JSON.parse(e.slice(1)||"null");t._dispatchMessage(r);break;case"c":var r=JSON.parse(e.slice(1)||"[]");t._didClose(r[0],r[1]);break;case"h":t._dispatchHeartbeat()}},x.prototype._try_next_protocol=function(t){var r=this;for(r.protocol&&(r._debug("Closed transport:",r.protocol,""+t),r.protocol=null),r._transport_tref&&(clearTimeout(r._transport_tref),r._transport_tref=null);;){var o=r.protocol=r._protocols.shift();if(!o)return!1;if(x[o]&&x[o].need_body===!0&&(!e.body||"undefined"!=typeof e.readyState&&"complete"!==e.readyState))return r._protocols.unshift(o),r.protocol="waiting-for-load",n.attachEvent("load",function(){r._try_next_protocol()}),!0;if(x[o]&&x[o].enabled(r._options)){var i=x[o].roundTrips||1,a=(r._options.rto||0)*i||5e3;r._transport_tref=n.delay(a,function(){r.readyState===x.CONNECTING&&r._didClose(2007,"Transport timeouted")});var s=n.random_string(8),u=r._base_url+"/"+r._server+"/"+s;return r._debug("Opening transport:",o," url:"+u," RTO:"+r._options.rto),r._transport=new x[o](r,u,r._base_url),!0}r._debug("Skipping transport:",o)}},x.prototype.close=function(e,t){var r=this;if(e&&!n.userSetCode(e))throw new Error("INVALID_ACCESS_ERR");return r.readyState!==x.CONNECTING&&r.readyState!==x.OPEN?!1:(r.readyState=x.CLOSING,r._didClose(e||1e3,t||"Normal closure"),!0)},x.prototype.send=function(e){var t=this;if(t.readyState===x.CONNECTING)throw new Error("INVALID_STATE_ERR");return t.readyState===x.OPEN&&t._transport.doSend(n.quote(""+e)),!0},x.prototype._applyInfo=function(t,r,o){var i=this;i._options.info=t,i._options.rtt=r,i._options.rto=n.countRTO(r),i._options.info.null_origin=!e.domain;var a=n.probeProtocols();i._protocols=n.detectProtocols(a,o,t)};var C=x.websocket=function(e,r){var o=this,i=r+"/websocket";i="https"===i.slice(0,5)?"wss"+i.slice(5):"ws"+i.slice(4),o.ri=e,o.url=i;var a=t.WebSocket||t.MozWebSocket;o.ws=new a(o.url),o.ws.onmessage=function(e){o.ri._didMessage(e.data)},o.unload_ref=n.unload_add(function(){o.ws.close()}),o.ws.onclose=function(){o.ri._didMessage(n.closeFrame(1006,"WebSocket connection broken"))}};C.prototype.doSend=function(e){this.ws.send("["+e+"]")},C.prototype.doCleanup=function(){var e=this,t=e.ws;t&&(t.onmessage=t.onclose=null,t.close(),n.unload_del(e.unload_ref),e.unload_ref=e.ri=e.ws=null)},C.enabled=function(){return!(!t.WebSocket&&!t.MozWebSocket)},C.roundTrips=2;var E=function(){};E.prototype.send_constructor=function(e){var t=this;t.send_buffer=[],t.sender=e},E.prototype.doSend=function(e){var t=this;t.send_buffer.push(e),t.send_stop||t.send_schedule()},E.prototype.send_schedule_wait=function(){var e,t=this;t.send_stop=function(){t.send_stop=null,clearTimeout(e)},e=n.delay(25,function(){t.send_stop=null,t.send_schedule()})},E.prototype.send_schedule=function(){var e=this;if(e.send_buffer.length>0){var t="["+e.send_buffer.join(",")+"]";e.send_stop=e.sender(e.trans_url,t,function(t,n){e.send_stop=null,t===!1?e.ri._didClose(1006,"Sending error "+n):e.send_schedule_wait()}),e.send_buffer=[]}},E.prototype.send_destructor=function(){var e=this;e._send_stop&&e._send_stop(),e._send_stop=null};var T=function(t,r,o){var i=this;if(!("_send_form"in i)){var a=i._send_form=e.createElement("form"),s=i._send_area=e.createElement("textarea");s.name="d",a.style.display="none",a.style.position="absolute",a.method="POST",a.enctype="application/x-www-form-urlencoded",a.acceptCharset="UTF-8",a.appendChild(s),e.body.appendChild(a)}var a=i._send_form,s=i._send_area,u="a"+n.random_string(8);a.target=u,a.action=t+"/jsonp_send?i="+u;var c;try{c=e.createElement('<iframe name="'+u+'">')}catch(l){c=e.createElement("iframe"),c.name=u}c.id=u,a.appendChild(c),c.style.display="none";try{s.value=r}catch(d){n.log("Your browser is seriously broken. Go home! "+d.message)}a.submit();var p=function(){c.onerror&&(c.onreadystatechange=c.onerror=c.onload=null,n.delay(500,function(){c.parentNode.removeChild(c),c=null}),s.value="",o(!0))};return c.onerror=c.onload=p,c.onreadystatechange=function(){"complete"==c.readyState&&p()},p},A=function(e){return function(t,n,r){var o=new e("POST",t+"/xhr_send",n);return o.onfinish=function(e){r(200===e||204===e,"http status "+e)},function(e){r(!1,e)}}},O=function(t,r){var o,i,a=e.createElement("script"),s=function(e){i&&(i.parentNode.removeChild(i),i=null),a&&(clearTimeout(o),a.parentNode.removeChild(a),a.onreadystatechange=a.onerror=a.onload=a.onclick=null,a=null,r(e),r=null)},u=!1,c=null;if(a.id="a"+n.random_string(8),a.src=t,a.type="text/javascript",a.charset="UTF-8",a.onerror=function(){c||(c=setTimeout(function(){u||s(n.closeFrame(1006,"JSONP script loaded abnormally (onerror)"))},1e3))},a.onload=function(){s(n.closeFrame(1006,"JSONP script loaded abnormally (onload)"))},a.onreadystatechange=function(){if(/loaded|closed/.test(a.readyState)){if(a&&a.htmlFor&&a.onclick){u=!0;try{a.onclick()}catch(e){}}a&&s(n.closeFrame(1006,"JSONP script loaded abnormally (onreadystatechange)"))}},"undefined"==typeof a.async&&e.attachEvent)if(/opera/i.test(navigator.userAgent))i=e.createElement("script"),i.text="try{var a = document.getElementById('"+a.id+"'); if(a)a.onerror();}catch(x){};",a.async=i.async=!1;else{try{a.htmlFor=a.id,a.event="onclick"}catch(l){}a.async=!0}"undefined"!=typeof a.async&&(a.async=!0),o=setTimeout(function(){s(n.closeFrame(1006,"JSONP script loaded abnormally (timeout)"))},35e3);var d=e.getElementsByTagName("head")[0];return d.insertBefore(a,d.firstChild),i&&d.insertBefore(i,d.firstChild),s},L=x["jsonp-polling"]=function(e,t){n.polluteGlobalNamespace();var r=this;r.ri=e,r.trans_url=t,r.send_constructor(T),r._schedule_recv()};L.prototype=new E,L.prototype._schedule_recv=function(){var e=this,t=function(t){e._recv_stop=null,t&&(e._is_closing||e.ri._didMessage(t)),e._is_closing||e._schedule_recv()};e._recv_stop=R(e.trans_url+"/jsonp",O,t)},L.enabled=function(){return!0},L.need_body=!0,L.prototype.doCleanup=function(){var e=this;e._is_closing=!0,e._recv_stop&&e._recv_stop(),e.ri=e._recv_stop=null,e.send_destructor()};var R=function(e,r,o){var i="a"+n.random_string(6),a=e+"?c="+escape(s+"."+i),u=0,c=function(e){switch(u){case 0:delete t[s][i],o(e);break;case 1:o(e),u=2;break;case 2:delete t[s][i]}},l=r(a,c);t[s][i]=l;var d=function(){t[s][i]&&(u=1,t[s][i](n.closeFrame(1e3,"JSONP user aborted read")))};return d},N=function(){};N.prototype=new E,N.prototype.run=function(e,t,n,r,o){var i=this;i.ri=e,i.trans_url=t,i.send_constructor(A(o)),i.poll=new K(e,r,t+n,o)},N.prototype.doCleanup=function(){var e=this;e.poll&&(e.poll.abort(),e.poll=null)};var j=x["xhr-streaming"]=function(e,t){this.run(e,t,"/xhr_streaming",rt,n.XHRCorsObject)};j.prototype=new N,j.enabled=function(){return t.XMLHttpRequest&&"withCredentials"in new XMLHttpRequest&&!/opera/i.test(navigator.userAgent)},j.roundTrips=2,j.need_body=!0;var P=x["xdr-streaming"]=function(e,t){this.run(e,t,"/xhr_streaming",rt,n.XDRObject)};P.prototype=new N,P.enabled=function(){return!!t.XDomainRequest},P.roundTrips=2;var I=x["xhr-polling"]=function(e,t){this.run(e,t,"/xhr",rt,n.XHRCorsObject)};I.prototype=new N,I.enabled=j.enabled,I.roundTrips=2;var M=x["xdr-polling"]=function(e,t){this.run(e,t,"/xhr",rt,n.XDRObject)};M.prototype=new N,M.enabled=P.enabled,M.roundTrips=2;var H=function(){};H.prototype.i_constructor=function(e,t,r){var o=this;o.ri=e,o.origin=n.getOrigin(r),o.base_url=r,o.trans_url=t;var i=r+"/iframe.html";o.ri._options.devel&&(i+="?t="+ +new Date),o.window_id=n.random_string(8),i+="#"+o.window_id,o.iframeObj=n.createIframe(i,function(e){o.ri._didClose(1006,"Unable to load an iframe ("+e+")")}),o.onmessage_cb=n.bind(o.onmessage,o),n.attachMessage(o.onmessage_cb)},H.prototype.doCleanup=function(){var e=this;if(e.iframeObj){n.detachMessage(e.onmessage_cb);try{e.iframeObj.iframe.contentWindow&&e.postMessage("c")}catch(t){}e.iframeObj.cleanup(),e.iframeObj=null,e.onmessage_cb=e.iframeObj=null}},H.prototype.onmessage=function(e){var t=this;if(e.origin===t.origin){var n=e.data.slice(0,8),r=e.data.slice(8,9),o=e.data.slice(9);if(n===t.window_id)switch(r){case"s":t.iframeObj.loaded(),t.postMessage("s",JSON.stringify([x.version,t.protocol,t.trans_url,t.base_url]));break;case"t":t.ri._didMessage(o)}}},H.prototype.postMessage=function(e,t){var n=this;n.iframeObj.post(n.window_id+e+(t||""),n.origin)},H.prototype.doSend=function(e){this.postMessage("m",e)},H.enabled=function(){var e=navigator&&navigator.userAgent&&-1!==navigator.userAgent.indexOf("Konqueror");return("function"==typeof t.postMessage||"object"==typeof t.postMessage)&&!e};var F,D=function(e,r){parent!==t?parent.postMessage(F+e+(r||""),"*"):n.log("Can't postMessage, no parent window.",e,r)},q=function(){};q.prototype._didClose=function(e,t){D("t",n.closeFrame(e,t))},q.prototype._didMessage=function(e){D("t",e)},q.prototype._doSend=function(e){this._transport.doSend(e)},q.prototype._doCleanup=function(){this._transport.doCleanup()},n.parent_origin=void 0,x.bootstrap_iframe=function(){var r;F=e.location.hash.slice(1);var o=function(e){if(e.source===parent&&("undefined"==typeof n.parent_origin&&(n.parent_origin=e.origin),e.origin===n.parent_origin)){var o=e.data.slice(0,8),i=e.data.slice(8,9),a=e.data.slice(9);if(o===F)switch(i){case"s":var s=JSON.parse(a),u=s[0],c=s[1],l=s[2],d=s[3];if(u!==x.version&&n.log('Incompatibile SockJS! Main site uses: "'+u+'", the iframe: "'+x.version+'".'),!n.flatUrl(l)||!n.flatUrl(d))return void n.log("Only basic urls are supported in SockJS");if(!n.isSameOriginUrl(l)||!n.isSameOriginUrl(d))return void n.log("Can't connect to different domain from within an iframe. ("+JSON.stringify([t.location.href,l,d])+")");r=new q,r._transport=new q[c](r,l,d);break;case"m":r._doSend(a);break;case"c":r&&r._doCleanup(),r=null}}};n.attachMessage(o),D("s")};var X=function(e,t){var r=this;n.delay(function(){r.doXhr(e,t)})};X.prototype=new i(["finish"]),X.prototype.doXhr=function(e,t){var r=this,o=(new Date).getTime(),i=new t("GET",e+"/info"),a=n.delay(8e3,function(){i.ontimeout()});i.onfinish=function(e,t){if(clearTimeout(a),a=null,200===e){var n=(new Date).getTime()-o,i=JSON.parse(t);"object"!=typeof i&&(i={}),r.emit("finish",i,n)}else r.emit("finish")},i.ontimeout=function(){i.close(),r.emit("finish")}};var B=function(t){var r=this,o=function(){var e=new H;e.protocol="w-iframe-info-receiver";var n=function(t){if("string"==typeof t&&"m"===t.substr(0,1)){var n=JSON.parse(t.substr(1)),o=n[0],i=n[1];r.emit("finish",o,i)}else r.emit("finish");e.doCleanup(),e=null},o={_options:{},_didClose:n,_didMessage:n};e.i_constructor(o,t,t)};e.body?o():n.attachEvent("load",o)};B.prototype=new i(["finish"]);var J=function(){var e=this;n.delay(function(){e.emit("finish",{},2e3)})};J.prototype=new i(["finish"]);var U=function(e){if(n.isSameOriginUrl(e))return new X(e,n.XHRLocalObject);switch(n.isXHRCorsCapable()){case 1:return new X(e,n.XHRLocalObject);case 2:return new X(e,n.XDRObject);case 3:return new B(e);default:return new J}},W=q["w-iframe-info-receiver"]=function(e,t,r){var o=new X(r,n.XHRLocalObject);o.onfinish=function(t,n){e._didMessage("m"+JSON.stringify([t,n])),e._didClose()}};W.prototype.doCleanup=function(){};var $=x["iframe-eventsource"]=function(){var e=this;e.protocol="w-iframe-eventsource",e.i_constructor.apply(e,arguments)};$.prototype=new H,$.enabled=function(){return"EventSource"in t&&H.enabled()},$.need_body=!0,$.roundTrips=3;var G=q["w-iframe-eventsource"]=function(e,t){this.run(e,t,"/eventsource",Z,n.XHRLocalObject)};G.prototype=new N;var z=x["iframe-xhr-polling"]=function(){var e=this;e.protocol="w-iframe-xhr-polling",e.i_constructor.apply(e,arguments)};z.prototype=new H,z.enabled=function(){return t.XMLHttpRequest&&H.enabled()},z.need_body=!0,z.roundTrips=3;var Q=q["w-iframe-xhr-polling"]=function(e,t){this.run(e,t,"/xhr",rt,n.XHRLocalObject)};Q.prototype=new N;var Y=x["iframe-htmlfile"]=function(){var e=this;e.protocol="w-iframe-htmlfile",e.i_constructor.apply(e,arguments)};Y.prototype=new H,Y.enabled=function(){return H.enabled()},Y.need_body=!0,Y.roundTrips=3;var V=q["w-iframe-htmlfile"]=function(e,t){this.run(e,t,"/htmlfile",nt,n.XHRLocalObject)};V.prototype=new N;var K=function(e,t,n,r){var o=this;o.ri=e,o.Receiver=t,o.recv_url=n,o.AjaxObject=r,o._scheduleRecv()};K.prototype._scheduleRecv=function(){var e=this,t=e.poll=new e.Receiver(e.recv_url,e.AjaxObject),n=0;t.onmessage=function(t){n+=1,e.ri._didMessage(t.data)},t.onclose=function(n){e.poll=t=t.onmessage=t.onclose=null,e.poll_is_closing||("permanent"===n.reason?e.ri._didClose(1006,"Polling error ("+n.reason+")"):e._scheduleRecv())}},K.prototype.abort=function(){var e=this;e.poll_is_closing=!0,e.poll&&e.poll.abort()};var Z=function(e){var t=this,r=new EventSource(e);r.onmessage=function(e){t.dispatchEvent(new o("message",{data:unescape(e.data)}))},t.es_close=r.onerror=function(e,i){var a=i?"user":2!==r.readyState?"network":"permanent";t.es_close=r.onmessage=r.onerror=null,r.close(),r=null,n.delay(200,function(){t.dispatchEvent(new o("close",{reason:a}))})}};Z.prototype=new r,Z.prototype.abort=function(){var e=this;e.es_close&&e.es_close({},!0)};var et,tt=function(){if(void 0===et)if("ActiveXObject"in t)try{et=!!new ActiveXObject("htmlfile")}catch(e){}else et=!1;return et},nt=function(e){var r=this;n.polluteGlobalNamespace(),r.id="a"+n.random_string(6,26),e+=(-1===e.indexOf("?")?"?":"&")+"c="+escape(s+"."+r.id);var i,a=tt()?n.createHtmlfile:n.createIframe;t[s][r.id]={start:function(){i.loaded()},message:function(e){r.dispatchEvent(new o("message",{data:e}))},stop:function(){r.iframe_close({},"network")}},r.iframe_close=function(e,n){i.cleanup(),r.iframe_close=i=null,delete t[s][r.id],r.dispatchEvent(new o("close",{reason:n}))},i=a(e,function(){r.iframe_close({},"permanent")})};nt.prototype=new r,nt.prototype.abort=function(){var e=this;e.iframe_close&&e.iframe_close({},"user")};var rt=function(e,t){var n=this,r=0;n.xo=new t("POST",e,null),n.xo.onchunk=function(e,t){if(200===e)for(;;){var i=t.slice(r),a=i.indexOf("\n");if(-1===a)break;r+=a+1;var s=i.slice(0,a);n.dispatchEvent(new o("message",{data:s}))}},n.xo.onfinish=function(e,t){n.xo.onchunk(e,t),n.xo=null;var r=200===e?"network":"permanent";n.dispatchEvent(new o("close",{reason:r}))}};return rt.prototype=new r,rt.prototype.abort=function(){var e=this;e.xo&&(e.xo.close(),e.dispatchEvent(new o("close",{reason:"user"})),e.xo=null)},x.getUtils=function(){return n},x.getIframeTransport=function(){return H},x}(),"_sockjs_onload"in window&&setTimeout(_sockjs_onload,1),"function"==typeof define&&define.amd&&define("sockjs",[],function(){return SockJS}),function(e){if("function"==typeof bootstrap)bootstrap("promise",e);else if("object"==typeof exports)module.exports=e();else if("function"==typeof define&&define.amd)define(e);else if("undefined"!=typeof ses){if(!ses.ok())return;ses.makeQ=e}else Q=e()}(function(){"use strict";function e(e){return function(){return G.apply(e,arguments)}}function t(e){return e===Object(e)}function n(e){return"[object StopIteration]"===tt(e)||e instanceof J}function r(e,t){if(q&&t.stack&&"object"==typeof e&&null!==e&&e.stack&&-1===e.stack.indexOf(nt)){for(var n=[],r=t;r;r=r.source)r.stack&&n.unshift(r.stack);n.unshift(e.stack);var i=n.join("\n"+nt+"\n");e.stack=o(i)}}function o(e){for(var t=e.split("\n"),n=[],r=0;r<t.length;++r){var o=t[r];s(o)||i(o)||!o||n.push(o)}return n.join("\n")}function i(e){return-1!==e.indexOf("(module.js:")||-1!==e.indexOf("(node.js:")}function a(e){var t=/at .+ \((.+):(\d+):(?:\d+)\)$/.exec(e);if(t)return[t[1],Number(t[2])];var n=/at ([^ ]+):(\d+):(?:\d+)$/.exec(e);if(n)return[n[1],Number(n[2])];var r=/.*@(.+):(\d+)$/.exec(e);return r?[r[1],Number(r[2])]:void 0}function s(e){var t=a(e);if(!t)return!1;var n=t[0],r=t[1];return n===B&&r>=U&&at>=r}function u(){if(q)try{throw new Error}catch(e){var t=e.stack.split("\n"),n=t[0].indexOf("@")>0?t[1]:t[2],r=a(n);if(!r)return;return B=r[0],r[1]}}function c(e,t,n){return function(){return"undefined"!=typeof console&&"function"==typeof console.warn&&console.warn(t+" is deprecated, use "+n+" instead.",new Error("").stack),e.apply(e,arguments)}}function l(e){return g(e)?e:_(e)?T(e):E(e)}function d(){function e(e){t=e,i.source=e,Q(n,function(t,n){$(function(){e.promiseDispatch.apply(e,n)})},void 0),n=void 0,r=void 0}var t,n=[],r=[],o=K(d.prototype),i=K(h.prototype);if(i.promiseDispatch=function(e,o,i){var a=z(arguments);n?(n.push(a),"when"===o&&i[1]&&r.push(i[1])):$(function(){t.promiseDispatch.apply(t,a)})},i.valueOf=function(){if(n)return i;var e=v(t);return g(e)&&(t=e),e},i.inspect=function(){return t?t.inspect():{state:"pending"}},l.longStackSupport&&q)try{throw new Error}catch(a){i.stack=a.stack.substring(a.stack.indexOf("\n")+1)}return o.promise=i,o.resolve=function(n){t||e(l(n))},o.fulfill=function(n){t||e(E(n))},o.reject=function(n){t||e(C(n))},o.notify=function(e){t||Q(r,function(t,n){$(function(){n(e)})},void 0)},o}function p(e){if("function"!=typeof e)throw new TypeError("resolver must be a function.");var t=d();try{e(t.resolve,t.reject,t.notify)}catch(n){t.reject(n)}return t.promise}function f(e){return p(function(t,n){for(var r=0,o=e.length;o>r;r++)l(e[r]).then(t,n)})}function h(e,t,n){void 0===t&&(t=function(e){return C(new Error("Promise does not support operation: "+e))}),void 0===n&&(n=function(){return{state:"unknown"}});var r=K(h.prototype);if(r.promiseDispatch=function(n,o,i){var a;try{a=e[o]?e[o].apply(r,i):t.call(r,o,i)}catch(s){a=C(s)}n&&n(a)},r.inspect=n,n){var o=n();"rejected"===o.state&&(r.exception=o.reason),r.valueOf=function(){var e=n();return"pending"===e.state||"rejected"===e.state?r:e.value}}return r}function m(e,t,n,r){return l(e).then(t,n,r)}function v(e){if(g(e)){var t=e.inspect();if("fulfilled"===t.state)return t.value}return e}function g(e){return t(e)&&"function"==typeof e.promiseDispatch&&"function"==typeof e.inspect}function _(e){return t(e)&&"function"==typeof e.then}function b(e){return g(e)&&"pending"===e.inspect().state}function y(e){return!g(e)||"fulfilled"===e.inspect().state}function w(e){return g(e)&&"rejected"===e.inspect().state}function S(){rt.length=0,ot.length=0,it||(it=!0)}function k(e,t){it&&(ot.push(e),rt.push(t&&"undefined"!=typeof t.stack?t.stack:"(no stack) "+t))}function x(e){if(it){var t=Y(ot,e);-1!==t&&(ot.splice(t,1),rt.splice(t,1))}}function C(e){var t=h({when:function(t){return t&&x(this),t?t(e):this}},function(){return this},function(){return{state:"rejected",reason:e}});return k(t,e),t}function E(e){return h({when:function(){return e},get:function(t){return e[t]},set:function(t,n){e[t]=n},"delete":function(t){delete e[t]},post:function(t,n){return null===t||void 0===t?e.apply(void 0,n):e[t].apply(e,n)},apply:function(t,n){return e.apply(t,n)},keys:function(){return et(e)}},void 0,function(){return{state:"fulfilled",value:e}})}function T(e){var t=d();return $(function(){try{e.then(t.resolve,t.reject,t.notify)}catch(n){t.reject(n)}}),t.promise}function A(e){return h({isDef:function(){}},function(t,n){return P(e,t,n)},function(){return l(e).inspect()})}function O(e,t,n){return l(e).spread(t,n)}function L(e){return function(){function t(e,t){var a;if("undefined"==typeof StopIteration){try{a=r[e](t)}catch(s){return C(s)}return a.done?a.value:m(a.value,o,i)}try{a=r[e](t)}catch(s){return n(s)?s.value:C(s)}return m(a,o,i)}var r=e.apply(this,arguments),o=t.bind(t,"next"),i=t.bind(t,"throw");return o()}}function R(e){l.done(l.async(e)())}function N(e){throw new J(e)}function j(e){return function(){return O([this,I(arguments)],function(t,n){return e.apply(t,n)})}}function P(e,t,n){return l(e).dispatch(t,n)}function I(e){return m(e,function(e){var t=0,n=d();return Q(e,function(r,o,i){var a;g(o)&&"fulfilled"===(a=o.inspect()).state?e[i]=a.value:(++t,m(o,function(r){e[i]=r,0===--t&&n.resolve(e)},n.reject,function(e){n.notify({index:i,value:e})}))},void 0),0===t&&n.resolve(e),n.promise})}function M(e){return m(e,function(e){return e=V(e,l),m(I(V(e,function(e){return m(e,W,W)})),function(){return e})})}function H(e){return l(e).allSettled()}function F(e,t){return l(e).then(void 0,void 0,t)}function D(e,t){return l(e).nodeify(t)}var q=!1;try{throw new Error}catch(X){q=!!X.stack}var B,J,U=u(),W=function(){},$=function(){function e(){for(;t.next;){t=t.next;var n=t.task;t.task=void 0;var o=t.domain;o&&(t.domain=void 0,o.enter());try{n()}catch(a){if(i)throw o&&o.exit(),setTimeout(e,0),o&&o.enter(),a;setTimeout(function(){throw a},0)}o&&o.exit()}r=!1}var t={task:void 0,next:null},n=t,r=!1,o=void 0,i=!1;if($=function(e){n=n.next={task:e,domain:i&&process.domain,next:null},r||(r=!0,o())},"undefined"!=typeof process&&process.nextTick)i=!0,o=function(){process.nextTick(e)};else if("function"==typeof setImmediate)o="undefined"!=typeof window?setImmediate.bind(window,e):function(){setImmediate(e)};else if("undefined"!=typeof MessageChannel){var a=new MessageChannel;a.port1.onmessage=function(){o=s,a.port1.onmessage=e,e()};var s=function(){a.port2.postMessage(0)};o=function(){setTimeout(e,0),s()}}else o=function(){setTimeout(e,0)};return $}(),G=Function.call,z=e(Array.prototype.slice),Q=e(Array.prototype.reduce||function(e,t){var n=0,r=this.length;if(1===arguments.length)for(;;){if(n in this){t=this[n++];break}if(++n>=r)throw new TypeError}for(;r>n;n++)n in this&&(t=e(t,this[n],n));return t}),Y=e(Array.prototype.indexOf||function(e){for(var t=0;t<this.length;t++)if(this[t]===e)return t;return-1}),V=e(Array.prototype.map||function(e,t){var n=this,r=[];return Q(n,function(o,i,a){r.push(e.call(t,i,a,n))},void 0),r}),K=Object.create||function(e){function t(){}return t.prototype=e,new t},Z=e(Object.prototype.hasOwnProperty),et=Object.keys||function(e){var t=[];for(var n in e)Z(e,n)&&t.push(n);return t},tt=e(Object.prototype.toString);J="undefined"!=typeof ReturnValue?ReturnValue:function(e){this.value=e};var nt="From previous event:";l.resolve=l,l.nextTick=$,l.longStackSupport=!1,l.defer=d,d.prototype.makeNodeResolver=function(){var e=this;return function(t,n){t?e.reject(t):e.resolve(arguments.length>2?z(arguments,1):n)}},l.Promise=p,l.promise=p,p.race=f,p.all=I,p.reject=C,p.resolve=l,l.passByCopy=function(e){return e},h.prototype.passByCopy=function(){return this},l.join=function(e,t){return l(e).join(t)},h.prototype.join=function(e){return l([this,e]).spread(function(e,t){if(e===t)return e;throw new Error("Can't join: not the same: "+e+" "+t)})},l.race=f,h.prototype.race=function(){return this.then(l.race)},l.makePromise=h,h.prototype.toString=function(){return"[object Promise]"},h.prototype.then=function(e,t,n){function o(t){try{return"function"==typeof e?e(t):t}catch(n){return C(n)}}function i(e){if("function"==typeof t){r(e,s);try{return t(e)}catch(n){return C(n)}}return C(e)}function a(e){return"function"==typeof n?n(e):e}var s=this,u=d(),c=!1;return $(function(){s.promiseDispatch(function(e){c||(c=!0,u.resolve(o(e)))},"when",[function(e){c||(c=!0,u.resolve(i(e)))}])}),s.promiseDispatch(void 0,"when",[void 0,function(e){var t,n=!1;try{t=a(e)}catch(r){if(n=!0,!l.onerror)throw r;l.onerror(r)}n||u.notify(t)}]),u.promise},l.when=m,h.prototype.thenResolve=function(e){return this.then(function(){return e})},l.thenResolve=function(e,t){return l(e).thenResolve(t)},h.prototype.thenReject=function(e){return this.then(function(){throw e})},l.thenReject=function(e,t){return l(e).thenReject(t)},l.nearer=v,l.isPromise=g,l.isPromiseAlike=_,l.isPending=b,h.prototype.isPending=function(){return"pending"===this.inspect().state},l.isFulfilled=y,h.prototype.isFulfilled=function(){return"fulfilled"===this.inspect().state},l.isRejected=w,h.prototype.isRejected=function(){return"rejected"===this.inspect().state};var rt=[],ot=[],it=!0;l.resetUnhandledRejections=S,l.getUnhandledReasons=function(){return rt.slice()},l.stopUnhandledRejectionTracking=function(){S(),it=!1},S(),l.reject=C,l.fulfill=E,l.master=A,l.spread=O,h.prototype.spread=function(e,t){return this.all().then(function(t){return e.apply(void 0,t)},t)},l.async=L,l.spawn=R,l["return"]=N,l.promised=j,l.dispatch=P,h.prototype.dispatch=function(e,t){var n=this,r=d();return $(function(){n.promiseDispatch(r.resolve,e,t)}),r.promise},l.get=function(e,t){return l(e).dispatch("get",[t])},h.prototype.get=function(e){return this.dispatch("get",[e])},l.set=function(e,t,n){return l(e).dispatch("set",[t,n])},h.prototype.set=function(e,t){return this.dispatch("set",[e,t])},l.del=l["delete"]=function(e,t){return l(e).dispatch("delete",[t])},h.prototype.del=h.prototype["delete"]=function(e){return this.dispatch("delete",[e])},l.mapply=l.post=function(e,t,n){return l(e).dispatch("post",[t,n])},h.prototype.mapply=h.prototype.post=function(e,t){return this.dispatch("post",[e,t])},l.send=l.mcall=l.invoke=function(e,t){return l(e).dispatch("post",[t,z(arguments,2)])},h.prototype.send=h.prototype.mcall=h.prototype.invoke=function(e){return this.dispatch("post",[e,z(arguments,1)])},l.fapply=function(e,t){return l(e).dispatch("apply",[void 0,t])},h.prototype.fapply=function(e){return this.dispatch("apply",[void 0,e])},l["try"]=l.fcall=function(e){return l(e).dispatch("apply",[void 0,z(arguments,1)])},h.prototype.fcall=function(){return this.dispatch("apply",[void 0,z(arguments)])},l.fbind=function(e){var t=l(e),n=z(arguments,1);return function(){return t.dispatch("apply",[this,n.concat(z(arguments))])}},h.prototype.fbind=function(){var e=this,t=z(arguments);return function(){return e.dispatch("apply",[this,t.concat(z(arguments))])
}},l.keys=function(e){return l(e).dispatch("keys",[])},h.prototype.keys=function(){return this.dispatch("keys",[])},l.all=I,h.prototype.all=function(){return I(this)},l.allResolved=c(M,"allResolved","allSettled"),h.prototype.allResolved=function(){return M(this)},l.allSettled=H,h.prototype.allSettled=function(){return this.then(function(e){return I(V(e,function(e){function t(){return e.inspect()}return e=l(e),e.then(t,t)}))})},l.fail=l["catch"]=function(e,t){return l(e).then(void 0,t)},h.prototype.fail=h.prototype["catch"]=function(e){return this.then(void 0,e)},l.progress=F,h.prototype.progress=function(e){return this.then(void 0,void 0,e)},l.fin=l["finally"]=function(e,t){return l(e)["finally"](t)},h.prototype.fin=h.prototype["finally"]=function(e){return e=l(e),this.then(function(t){return e.fcall().then(function(){return t})},function(t){return e.fcall().then(function(){throw t})})},l.done=function(e,t,n,r){return l(e).done(t,n,r)},h.prototype.done=function(e,t,n){var o=function(e){$(function(){if(r(e,i),!l.onerror)throw e;l.onerror(e)})},i=e||t||n?this.then(e,t,n):this;"object"==typeof process&&process&&process.domain&&(o=process.domain.bind(o)),i.then(void 0,o)},l.timeout=function(e,t,n){return l(e).timeout(t,n)},h.prototype.timeout=function(e,t){var n=d(),r=setTimeout(function(){n.reject(new Error(t||"Timed out after "+e+" ms"))},e);return this.then(function(e){clearTimeout(r),n.resolve(e)},function(e){clearTimeout(r),n.reject(e)},n.notify),n.promise},l.delay=function(e,t){return void 0===t&&(t=e,e=void 0),l(e).delay(t)},h.prototype.delay=function(e){return this.then(function(t){var n=d();return setTimeout(function(){n.resolve(t)},e),n.promise})},l.nfapply=function(e,t){return l(e).nfapply(t)},h.prototype.nfapply=function(e){var t=d(),n=z(e);return n.push(t.makeNodeResolver()),this.fapply(n).fail(t.reject),t.promise},l.nfcall=function(e){var t=z(arguments,1);return l(e).nfapply(t)},h.prototype.nfcall=function(){var e=z(arguments),t=d();return e.push(t.makeNodeResolver()),this.fapply(e).fail(t.reject),t.promise},l.nfbind=l.denodeify=function(e){var t=z(arguments,1);return function(){var n=t.concat(z(arguments)),r=d();return n.push(r.makeNodeResolver()),l(e).fapply(n).fail(r.reject),r.promise}},h.prototype.nfbind=h.prototype.denodeify=function(){var e=z(arguments);return e.unshift(this),l.denodeify.apply(void 0,e)},l.nbind=function(e,t){var n=z(arguments,2);return function(){function r(){return e.apply(t,arguments)}var o=n.concat(z(arguments)),i=d();return o.push(i.makeNodeResolver()),l(r).fapply(o).fail(i.reject),i.promise}},h.prototype.nbind=function(){var e=z(arguments,0);return e.unshift(this),l.nbind.apply(void 0,e)},l.nmapply=l.npost=function(e,t,n){return l(e).npost(t,n)},h.prototype.nmapply=h.prototype.npost=function(e,t){var n=z(t||[]),r=d();return n.push(r.makeNodeResolver()),this.dispatch("post",[e,n]).fail(r.reject),r.promise},l.nsend=l.nmcall=l.ninvoke=function(e,t){var n=z(arguments,2),r=d();return n.push(r.makeNodeResolver()),l(e).dispatch("post",[t,n]).fail(r.reject),r.promise},h.prototype.nsend=h.prototype.nmcall=h.prototype.ninvoke=function(e){var t=z(arguments,1),n=d();return t.push(n.makeNodeResolver()),this.dispatch("post",[e,t]).fail(n.reject),n.promise},l.nodeify=D,h.prototype.nodeify=function(e){return e?void this.then(function(t){$(function(){e(null,t)})},function(t){$(function(){e(t)})}):this};var at=u();return l}),function(e,t){"function"==typeof define&&define.amd?define(t):"object"==typeof exports?module.exports=t():e.DDP=t()}(this,function(){"use strict";var e=function(){var e=0;return function(){return(e++).toString()}}(),t='{"server_id":"0"}',n=10,r=500,o=["added","changed","connected","error","failed","nosub","ready","removed","result","updated","ping"],i=function(e){this._endpoint=e.endpoint,this._SocketConstructor=e.SocketConstructor,this._autoreconnect=!e.do_not_autoreconnect,this._debug=e.debug,this._onReadyCallbacks={},this._onStopCallbacks={},this._onErrorCallbacks={},this._onResultCallbacks={},this._onUpdatedCallbacks={},this._events={},this._queue=[],this.readyState=-1,this._reconnect_count=0,this._reconnect_incremental_timer=0,e.do_not_autoconnect||this.connect()};return i.prototype.constructor=i,i.prototype.connect=function(){this.readyState=0,this._socket=new this._SocketConstructor(this._endpoint),this._socket.onopen=this._on_socket_open.bind(this),this._socket.onmessage=this._on_socket_message.bind(this),this._socket.onerror=this._on_socket_error.bind(this),this._socket.onclose=this._on_socket_close.bind(this)},i.prototype.method=function(t,n,r,o){var i=e();return this._onResultCallbacks[i]=r,this._onUpdatedCallbacks[i]=o,this._send({msg:"method",id:i,method:t,params:n}),i},i.prototype.sub=function(t,n,r,o,i){var a=e();return this._onReadyCallbacks[a]=r,this._onStopCallbacks[a]=o,this._onErrorCallbacks[a]=i,this._send({msg:"sub",id:a,name:t,params:n}),a},i.prototype.unsub=function(e){this._send({msg:"unsub",id:e})},i.prototype.on=function(e,t){this._events[e]=this._events[e]||[],this._events[e].push(t)},i.prototype.off=function(e,t){this._events[e]&&this._events[e].splice(this._events[e].indexOf(t),1)},i.prototype._emit=function(e){if(this._events[e]){var t=arguments,n=this;this._events[e].forEach(function(e){e.apply(n,Array.prototype.slice.call(t,1))})}},i.prototype._send=function(e){if(1!==this.readyState&&"connect"!==e.msg)return void this._queue.push(e);var t;t="undefined"==typeof EJSON?JSON.stringify(e):EJSON.stringify(e),this._socket.send(t)},i.prototype._try_reconnect=function(){this._reconnect_count<n&&setTimeout(this.connect.bind(this),this._reconnect_incremental_timer),this._reconnect_count+=1,this._reconnect_incremental_timer+=r*this._reconnect_count},i.prototype._on_result=function(e){if(this._onResultCallbacks[e.id])this._onResultCallbacks[e.id](e.error,e.result),delete this._onResultCallbacks[e.id],e.error&&delete this._onUpdatedCallbacks[e.id];else if(e.error)throw delete this._onUpdatedCallbacks[e.id],e.error},i.prototype._on_updated=function(e){var t=this;e.methods.forEach(function(e){t._onUpdatedCallbacks[e]&&(t._onUpdatedCallbacks[e](),delete t._onUpdatedCallbacks[e])})},i.prototype._on_nosub=function(e){if(e.error){if(!this._onErrorCallbacks[e.id])throw delete this._onReadyCallbacks[e.id],delete this._onStopCallbacks[e.id],new Error(e.error);return this._onErrorCallbacks[e.id](e.error),delete this._onReadyCallbacks[e.id],delete this._onStopCallbacks[e.id],void delete this._onErrorCallbacks[e.id]}this._onStopCallbacks[e.id]&&this._onStopCallbacks[e.id](),delete this._onReadyCallbacks[e.id],delete this._onStopCallbacks[e.id],delete this._onErrorCallbacks[e.id]},i.prototype._on_ready=function(e){var t=this;e.subs.forEach(function(e){t._onReadyCallbacks[e]&&(t._onReadyCallbacks[e](),delete t._onReadyCallbacks[e])})},i.prototype._on_error=function(e){this._emit("error",e)},i.prototype._on_connected=function(e){var t=0===this._reconnect_count,n=t?"connected":"reconnected";this.readyState=1,this._reconnect_count=0,this._reconnect_incremental_timer=0;for(var r=this._queue.length,o=0;r>o;o++)this._send(this._queue.shift());this._emit(n,e)},i.prototype._on_failed=function(e){this.readyState=4,this._emit("failed",e)},i.prototype._on_added=function(e){this._emit("added",e)},i.prototype._on_removed=function(e){this._emit("removed",e)},i.prototype._on_changed=function(e){this._emit("changed",e)},i.prototype._on_ping=function(e){this._send({msg:"pong",id:e.id})},i.prototype._on_socket_close=function(){this.readyState=4,this._emit("socket_close"),this._autoreconnect&&this._try_reconnect()},i.prototype._on_socket_error=function(e){this.readyState=4,this._emit("socket_error",e)},i.prototype._on_socket_open=function(){this._send({msg:"connect",version:"pre1",support:["pre1"]})},i.prototype._on_socket_message=function(e){var n;if(this._debug&&console.log(e),e.data!==t){try{if(n="undefined"==typeof EJSON?JSON.parse(e.data):EJSON.parse(e.data),-1===o.indexOf(n.msg))throw new Error}catch(r){return console.warn("Non DDP message received:"),void console.warn(e.data)}this["_on_"+n.msg](n)}},i}),function(e,t){"function"==typeof define&&define.amd?define(t):"object"==typeof exports?module.exports=t():e.Asteroid=t()}(this,function(){"use strict";function e(e){if("undefined"!=typeof EJSON)return EJSON.clone(e);var t=typeof e;switch(t){case"undefined":case"function":return void 0;case"string":case"number":case"boolean":return e;case"object":return null===e?null:JSON.parse(JSON.stringify(e));default:return}}function t(e){var t="";for(var n in e)t+=n+"="+e[n]+"&";return t=t.slice(0,-1)}function n(){for(var e="",t=0;8>t;t++)e+=Math.floor(65536*(1+Math.random())).toString(16).substring(1);return e}function r(e){return-1!==e.indexOf("@")}var o=function(){};o.prototype={constructor:o,on:function(e,t){this._events||(this._events={}),this._events[e]=this._events[e]||[],this._events[e].push(t)},off:function(e,t){this._events||(this._events={}),this._events[e]&&this._events[e].splice(this._events[e].indexOf(t),1)},_emit:function(e){if(this._events||(this._events={}),this._events[e]){var t=arguments,n=this;this._events[e].forEach(function(e){e.apply(n,Array.prototype.slice.call(t,1))})}}};var i={};i._toString=function(e){return Object.prototype.toString.call(e).slice(8,-1)},i.beString=function(e){var t=this._toString(e);if("String"!==t)throw new Error("Assertion failed: expected String, instead got "+t)},i.beArray=function(e){var t=this._toString(e);if("Array"!==t)throw new Error("Assertion failed: expected Array, instead got "+t)},i.beObject=function(e){var t=this._toString(e);if("Object"!==t)throw new Error("Assertion failed: expected Object, instead got "+t)};var a=function(e,t,n){i.beString(e),this._host=(t?"https://":"http://")+e,this._ddpOptions="function"==typeof SockJS?{endpoint:(t?"https://":"http://")+e+"/sockjs",SocketConstructor:SockJS,debug:n}:{endpoint:(t?"wss://":"ws://")+e+"/websocket",SocketConstructor:WebSocket,debug:n},this.collections={},this.subscriptions={},this._init()};a.prototype=Object.create(o.prototype),a.prototype.constructor=a,a.prototype._init=function(){var e=this;e.ddp=new DDP(this._ddpOptions),e.ddp.on("connected",function(){e.resumeLoginPromise=e._tryResumeLogin(),e.ddp.sub("meteor.loginServiceConfiguration"),e._emit("connected")}),e.ddp.on("reconnected",function(){e.resumeLoginPromise=e._tryResumeLogin(),e._reEstablishSubscriptions(),e._emit("reconnected")}),e.ddp.on("added",function(t){e._onAdded(t)}),e.ddp.on("changed",function(t){e._onChanged(t)}),e.ddp.on("removed",function(t){e._onRemoved(t)})},a.prototype._onAdded=function(e){var t=e.collection;this.collections[t]||(this.collections[t]=new a._Collection(t,this));var n=e.fields||{};n._id=e.id,this.collections[t]._remoteToLocalInsert(n)},a.prototype._onRemoved=function(e){this.collections[e.collection]&&this.collections[e.collection]._remoteToLocalRemove(e.id)},a.prototype._onChanged=function(e){this.collections[e.collection]&&(e.fields||(e.fields={}),e.cleared&&e.cleared.forEach(function(t){e.fields[t]=void 0}),this.collections[e.collection]._remoteToLocalUpdate(e.id,e.fields))},a.prototype.call=function(e){i.beString(e);var t=Array.prototype.slice.call(arguments,1);return this.apply(e,t)},a.prototype.apply=function(e,t){i.beString(e),Array.isArray(t)||(t=[]);var n=Q.defer(),r=Q.defer(),o=function(e,t){e?(n.reject(e),r.reject()):n.resolve(t)},a=function(){r.resolve()};return this.ddp.method(e,t,o,a),{result:n.promise,updated:r.promise}},a.prototype.createCollection=function(e){return i.beString(e),this.collections[e]||(this.collections[e]=new a._Collection(e,this)),this.collections[e]};var s="__del__",u="__upd__",c=function(e){var t=s.length,n=u.length,r=e.slice(-1*t),o=e.slice(-1*n);return r===s||o===u},l=function(e,t){this.name=e,this.asteroid=t,this._set=new f};l.prototype.constructor=l,l.prototype._localToLocalInsert=function(e){if(this._set.contains(e._id))throw new Error("Item "+e._id+" already exists");return this._set.put(e._id,e),Q(e._id)},l.prototype._remoteToLocalInsert=function(e){this._set.put(e._id,e)},l.prototype._localToRemoteInsert=function(e){var t=this,n=Q.defer(),r="/"+t.name+"/insert";return t.asteroid.ddp.method(r,[e],function(r){r?(t._set.del(e._id),n.reject(r)):n.resolve(e._id)}),n.promise},l.prototype.insert=function(e){return e._id||(e._id=n()),{local:this._localToLocalInsert(e),remote:this._localToRemoteInsert(e)}},l.prototype._localToLocalRemove=function(e){var t=this._set.get(e);return t&&(this._set.put(e+s,t),this._set.del(e)),Q(e)},l.prototype._remoteToLocalRemove=function(e){this._set.del(e)},l.prototype._localToRemoteRemove=function(e){var t=this,n=Q.defer(),r="/"+t.name+"/remove";return t.asteroid.ddp.method(r,[{_id:e}],function(r){if(r){var o=t._set.get(e+s);o&&(t._set.put(e,o),t._set.del(e+s)),n.reject(r)}else t._set.del(e+s),n.resolve(e)}),n.promise},l.prototype.remove=function(e){return{local:this._localToLocalRemove(e),remote:this._localToRemoteRemove(e)}},l.prototype._localToLocalUpdate=function(e,t){var n=this._set.get(e);if(!n)throw new Error("Item "+e+" doesn't exist");if(t._id&&t._id!==e)throw new Error("Modifying the _id of a document is not allowed");this._set.put(e+u,n);for(var r in t)n[r]=t[r];return this._set.put(e,n),Q(e)},l.prototype._remoteToLocalUpdate=function(e,t){var n=this._set.get(e);if(!n)return void console.warn("Server misbehaviour: item "+e+" doesn't exist");for(var r in t){if("_id"===r&&t._id!==e)return void console.warn("Server misbehaviour: modifying the _id of a document is not allowed");n[r]=t[r]}this._set.put(e,n)},l.prototype._localToRemoteUpdate=function(e,t){var n=this,r=Q.defer(),o="/"+n.name+"/update",i={_id:e},a={$set:t};return n.asteroid.ddp.method(o,[i,a],function(t){if(t){var o=n._set.get(e+u);n._set.put(e,o),n._set.del(e+u),r.reject(t)}else n._set.del(e+u),r.resolve(e)}),r.promise},l.prototype.update=function(e,t){return{local:this._localToLocalUpdate(e,t),remote:this._localToRemoteUpdate(e,t)}};var d=function(e){var t=this;t.result=[],t._set=e,t._getResult(),t._set.on("put",function(e){t._getResult(),t._emit("change",e)}),t._set.on("del",function(e){t._getResult(),t._emit("change",e)})};d.prototype=Object.create(o.prototype),d.constructor=d,d.prototype._getResult=function(){this.result=this._set.toArray()};var p=function(e){return function(t,n){if(c(t))return!1;var r=function(e,t){return t.split(".").reduce(function(e,t){return e?e=e[t]:e},e)};for(var o in e){var i=r(n,o);if(i!==e[o])return!1}return!0}};l.prototype.reactiveQuery=function(e){var t;t="function"==typeof e?e:p(e);var n=this._set.filter(t);return new d(n)},a._Collection=l,a.prototype._getOauthClientId=function(e){var t="meteor_accounts_loginServiceConfiguration",n=this.collections[t],r=n.reactiveQuery({service:e}).result[0];return r.clientId||r.consumerKey||r.appId},a.prototype._initOauthLogin=function(e,t,n){var r=window.open(n,"Login"),o=this;return Q().then(function(){var e=Q.defer();r.focus&&r.focus();var t=setInterval(function(){(r.closed||void 0===r.closed)&&(clearInterval(t),e.resolve())},100);return e.promise}).then(function(){var e=Q.defer(),n={oauth:{credentialToken:t}};return o.ddp.method("login",[n],function(t,n){t?(delete o.userId,delete o.loggedIn,delete localStorage[o._host+"__login_token__"],e.reject(t),o._emit("loginError",t)):(o.userId=n.id,o.loggedIn=!0,localStorage[o._host+"__login_token__"]=n.token,o._emit("login",n.id),e.resolve(n.id))}),e.promise})},a.prototype._tryResumeLogin=function(){var e=this,t=Q.defer(),n=localStorage[e._host+"__login_token__"];if(!n)return t.reject("No login token"),t.promise;var r={resume:n};return e.ddp.method("login",[r],function(n,r){n?(delete e.userId,delete e.loggedIn,delete localStorage[e._host+"__login_token__"],e._emit("loginError",n),t.reject(n)):(e.userId=r.id,e.loggedIn=!0,localStorage[e._host+"__login_token__"]=r.token,e._emit("login",r.id),t.resolve(r.id))}),t.promise},a.prototype.loginWithFacebook=function(e){var r=n(),o={client_id:this._getOauthClientId("facebook"),redirect_uri:this._host+"/_oauth/facebook?close",state:r,scope:e||"email"},i="https://www.facebook.com/dialog/oauth?"+t(o);return this._initOauthLogin("facebook",r,i)},a.prototype.loginWithGoogle=function(e){var r=n(),o={response_type:"code",client_id:this._getOauthClientId("google"),redirect_uri:this._host+"/_oauth/google?close",state:r,scope:e||"openid email"},i="https://accounts.google.com/o/oauth2/auth?"+t(o);return this._initOauthLogin("google",r,i)},a.prototype.loginWithGithub=function(e){var r=n(),o={client_id:this._getOauthClientId("github"),redirect_uri:this._host+"/_oauth/github?close",state:r,scope:e||"email"},i="https://github.com/login/oauth/authorize?"+t(o);return this._initOauthLogin("github",r,i)},a.prototype.loginWithTwitter=function(){var e=n(),r=this._host+"/_oauth/twitter?close&state="+e,o={requestTokenAndRedirect:encodeURIComponent(r),state:e},i=this._host+"/_oauth/twitter/?"+t(o);return this._initOauthLogin("twitter",e,i)},a.prototype.createUser=function(e,t,n){var o=this,i=Q.defer(),a={username:r(e)?void 0:e,email:r(e)?e:void 0,password:t,profile:n};return o.ddp.method("createUser",[a],function(e,t){e?(o._emit("createUserError",e),i.reject(e)):(o.userId=t.id,o.loggedIn=!0,localStorage[o._host+"__login_token__"]=t.token,o._emit("createUser",t.id),o._emit("login",t.id),i.resolve(t.id))}),i.promise},a.prototype.loginWithPassword=function(e,t){var n=this,o=Q.defer(),i={password:t,user:{username:r(e)?void 0:e,email:r(e)?e:void 0}};return n.ddp.method("login",[i],function(e,t){e?(delete n.userId,delete n.loggedIn,delete localStorage[n._host+"__login_token__"],o.reject(e),n._emit("loginError",e)):(n.userId=t.id,n.loggedIn=!0,localStorage[n._host+"__login_token__"]=t.token,n._emit("login",t.id),o.resolve(t.id))}),o.promise},a.prototype.logout=function(){var e=this,t=Q.defer();return e.ddp.method("logout",[],function(n){n?(e._emit("logoutError",n),t.reject(n)):(delete e.userId,delete e.loggedIn,delete localStorage[e._host+"__login_token__"],e._emit("logout"),t.resolve())}),t.promise};var f=function(e){e&&(this._put=this.put,this._del=this.del,this.put=this.del=function(){throw new Error("Attempt to modify readonly set")}),this._items={}};f.prototype=Object.create(o.prototype),f.constructor=f,f.prototype.put=function(t,n){return i.beString(t),i.beObject(n),this._items[t]=e(n),this._emit("put",t),this},f.prototype.del=function(e){return i.beString(e),delete this._items[e],this._emit("del",e),this},f.prototype.get=function(t){return i.beString(t),e(this._items[t])},f.prototype.contains=function(e){return i.beString(e),!!this._items[e]},f.prototype.filter=function(t){var n=new f(!0),r=this._items,o=Object.keys(r);return o.forEach(function(o){var i=e(r[o]),a=t(o,i);a&&(n._items[o]=r[o])}),this.on("put",function(o){var i=e(r[o]),a=t(o,i);a&&n._put(o,r[o])}),this.on("del",function(e){n._del(e)}),n},f.prototype.toArray=function(){var t=[],n=this._items,r=Object.keys(this._items);return r.forEach(function(e){t.push(n[e])}),e(t)},f.prototype.toHash=function(){return e(this._items)},a.Set=f;var h=function(e,t,n){this._name=e,this._params=t,this._asteroid=n,this._ready=Q.defer(),this.ready=this._ready.promise;var r=this._onReady.bind(this),o=this._onStop.bind(this),i=this._onError.bind(this);this.id=n.ddp.sub(e,t,r,o,i)};return h.constructor=h,h.prototype.stop=function(){this._asteroid.ddp.unsub(this.id)},h.prototype._onReady=function(){this._ready.resolve()},h.prototype._onStop=function(){delete this._asteroid.subscriptions[this.id]},h.prototype._onError=function(e){this.ready.isPending()&&this._ready.reject(e),delete this._asteroid.subscriptions[this.id]},a.prototype.subscribe=function(e){i.beString(e);var t=Array.prototype.slice.call(arguments,1),n=new h(e,t,this);return this.subscriptions[n.id]=n,n},a.prototype._reEstablishSubscriptions=function(){var e=this.subscriptions;for(var t in e)e[t]=new h(e[t]._name,e[t]._params,this)},a}),"object"==typeof module&&(module.exports=MediumEditor),function(e,t){"use strict";function n(e,t){var n;if(void 0===e)return t;for(n in t)t.hasOwnProperty(n)&&e.hasOwnProperty(n)===!1&&(e[n]=t[n]);return e}function r(){var t,n,r,o=e.getSelection();if(o.getRangeAt&&o.rangeCount){for(r=[],t=0,n=o.rangeCount;n>t;t+=1)r.push(o.getRangeAt(t));return r}return null}function o(t){var n,r,o=e.getSelection();if(t)for(o.removeAllRanges(),n=0,r=t.length;r>n;n+=1)o.addRange(t[n])}function i(){var e=t.getSelection().anchorNode,n=e&&3===e.nodeType?e.parentNode:e;return n}function a(){var n,r,o,i,a="";if(void 0!==e.getSelection){if(r=e.getSelection(),r.rangeCount){for(i=t.createElement("div"),n=0,o=r.rangeCount;o>n;n+=1)i.appendChild(r.getRangeAt(n).cloneContents());a=i.innerHTML}}else void 0!==t.selection&&"Text"===t.selection.type&&(a=t.selection.createRange().htmlText);return a}function s(e){return!(!e||1!==e.nodeType)}MediumEditor.prototype={defaults:{allowMultiParagraphSelection:!0,anchorInputPlaceholder:"Paste or type a link",anchorPreviewHideDelay:500,buttons:["bold","italic","underline","anchor","header1","header2","quote"],buttonLabels:!1,checkLinkFormat:!1,cleanPastedHTML:!1,delay:0,diffLeft:0,diffTop:-10,disableReturn:!1,disableDoubleReturn:!1,disableToolbar:!1,disableEditing:!1,elementsContainer:!1,firstHeader:"h3",forcePlainText:!0,placeholder:"Type your text",secondHeader:"h4",targetBlank:!1,extensions:{}},isIE:"Microsoft Internet Explorer"===navigator.appName||"Netscape"===navigator.appName&&null!==new RegExp("Trident/.*rv:([0-9]{1,}[.0-9]{0,})").exec(navigator.userAgent),init:function(e,r){return this.setElementSelection(e),0!==this.elements.length?(this.parentElements=["p","h1","h2","h3","h4","h5","h6","blockquote","pre"],this.id=t.querySelectorAll(".medium-editor-toolbar").length+1,this.options=n(r,this.defaults),this.setup()):void 0},setup:function(){this.isActive=!0,this.initElements().bindSelect().bindPaste().setPlaceholders().bindWindowActions()},initElements:function(){this.updateElementList();var e,n=!1;for(e=0;e<this.elements.length;e+=1)this.options.disableEditing||this.elements[e].getAttribute("data-disable-editing")||this.elements[e].setAttribute("contentEditable",!0),this.elements[e].getAttribute("data-placeholder")||this.elements[e].setAttribute("data-placeholder",this.options.placeholder),this.elements[e].setAttribute("data-medium-element",!0),this.bindParagraphCreation(e).bindReturn(e).bindTab(e),this.options.disableToolbar||this.elements[e].getAttribute("data-disable-toolbar")||(n=!0);return n&&(this.options.elementsContainer||(this.options.elementsContainer=t.body),this.initToolbar().bindButtons().bindAnchorForm().bindAnchorPreview()),this},setElementSelection:function(e){this.elementSelection=e,this.updateElementList()},updateElementList:function(){this.elements="string"==typeof this.elementSelection?t.querySelectorAll(this.elementSelection):this.elementSelection,1===this.elements.nodeType&&(this.elements=[this.elements])},serialize:function(){var e,t,n={};for(e=0;e<this.elements.length;e+=1)t=""!==this.elements[e].id?this.elements[e].id:"element-"+e,n[t]={value:this.elements[e].innerHTML.trim()};return n},callExtensions:function(e){if(!(arguments.length<1)){var t,n,r=Array.prototype.slice.call(arguments,1);for(n in this.options.extensions)this.options.extensions.hasOwnProperty(n)&&(t=this.options.extensions[n],void 0!==t[e]&&t[e].apply(t,r))}},bindParagraphCreation:function(e){var n=this;return this.elements[e].addEventListener("keypress",function(e){var n,r=i();32===e.which&&(n=r.tagName.toLowerCase(),"a"===n&&t.execCommand("unlink",!1,null))}),this.elements[e].addEventListener("keyup",function(e){var r,o=i();o&&o.getAttribute("data-medium-element")&&0===o.children.length&&!n.options.disableReturn&&!o.getAttribute("data-disable-return")&&t.execCommand("formatBlock",!1,"p"),13===e.which&&(o=i(),r=o.tagName.toLowerCase(),n.options.disableReturn||this.getAttribute("data-disable-return")||"li"===r||n.isListItemChild(o)||(e.shiftKey||t.execCommand("formatBlock",!1,"p"),"a"===r&&t.execCommand("unlink",!1,null)))}),this},isListItemChild:function(e){for(var t=e.parentNode,n=t.tagName.toLowerCase();-1===this.parentElements.indexOf(n)&&"div"!==n;){if("li"===n)return!0;if(t=t.parentNode,!t||!t.tagName)return!1;n=t.tagName.toLowerCase()}return!1},bindReturn:function(e){var t=this;return this.elements[e].addEventListener("keypress",function(e){if(13===e.which)if(t.options.disableReturn||this.getAttribute("data-disable-return"))e.preventDefault();else if(t.options.disableDoubleReturn||this.getAttribute("data-disable-double-return")){var n=i();n&&"\n"===n.innerText&&e.preventDefault()}}),this},bindTab:function(e){return this.elements[e].addEventListener("keydown",function(e){if(9===e.which){var n=i().tagName.toLowerCase();"pre"===n&&(e.preventDefault(),t.execCommand("insertHtml",null,"    "))}}),this},buttonTemplate:function(e){var t=this.getButtonLabels(this.options.buttonLabels),n={bold:'<button class="medium-editor-action medium-editor-action-bold" data-action="bold" data-element="b">'+t.bold+"</button>",italic:'<button class="medium-editor-action medium-editor-action-italic" data-action="italic" data-element="i">'+t.italic+"</button>",underline:'<button class="medium-editor-action medium-editor-action-underline" data-action="underline" data-element="u">'+t.underline+"</button>",strikethrough:'<button class="medium-editor-action medium-editor-action-strikethrough" data-action="strikethrough" data-element="strike"><strike>A</strike></button>',superscript:'<button class="medium-editor-action medium-editor-action-superscript" data-action="superscript" data-element="sup">'+t.superscript+"</button>",subscript:'<button class="medium-editor-action medium-editor-action-subscript" data-action="subscript" data-element="sub">'+t.subscript+"</button>",anchor:'<button class="medium-editor-action medium-editor-action-anchor" data-action="anchor" data-element="a">'+t.anchor+"</button>",image:'<button class="medium-editor-action medium-editor-action-image" data-action="image" data-element="img">'+t.image+"</button>",header1:'<button class="medium-editor-action medium-editor-action-header1" data-action="append-'+this.options.firstHeader+'" data-element="'+this.options.firstHeader+'">'+t.header1+"</button>",header2:'<button class="medium-editor-action medium-editor-action-header2" data-action="append-'+this.options.secondHeader+'" data-element="'+this.options.secondHeader+'">'+t.header2+"</button>",quote:'<button class="medium-editor-action medium-editor-action-quote" data-action="append-blockquote" data-element="blockquote">'+t.quote+"</button>",orderedlist:'<button class="medium-editor-action medium-editor-action-orderedlist" data-action="insertorderedlist" data-element="ol">'+t.orderedlist+"</button>",unorderedlist:'<button class="medium-editor-action medium-editor-action-unorderedlist" data-action="insertunorderedlist" data-element="ul">'+t.unorderedlist+"</button>",pre:'<button class="medium-editor-action medium-editor-action-pre" data-action="append-pre" data-element="pre">'+t.pre+"</button>",indent:'<button class="medium-editor-action medium-editor-action-indent" data-action="indent" data-element="ul">'+t.indent+"</button>",outdent:'<button class="medium-editor-action medium-editor-action-outdent" data-action="outdent" data-element="ul">'+t.outdent+"</button>"};return n[e]||!1},getButtonLabels:function(e){var t,n,r={bold:"<b>B</b>",italic:"<b><i>I</i></b>",underline:"<b><u>U</u></b>",superscript:"<b>x<sup>1</sup></b>",subscript:"<b>x<sub>1</sub></b>",anchor:"<b>#</b>",image:"<b>image</b>",header1:"<b>H1</b>",header2:"<b>H2</b>",quote:"<b>&ldquo;</b>",orderedlist:"<b>1.</b>",unorderedlist:"<b>&bull;</b>",pre:"<b>0101</b>",indent:"<b>&rarr;</b>",outdent:"<b>&larr;</b>"};if("fontawesome"===e?t={bold:'<i class="fa fa-bold"></i>',italic:'<i class="fa fa-italic"></i>',underline:'<i class="fa fa-underline"></i>',superscript:'<i class="fa fa-superscript"></i>',subscript:'<i class="fa fa-subscript"></i>',anchor:'<i class="fa fa-link"></i>',image:'<i class="fa fa-picture-o"></i>',quote:'<i class="fa fa-quote-right"></i>',orderedlist:'<i class="fa fa-list-ol"></i>',unorderedlist:'<i class="fa fa-list-ul"></i>',pre:'<i class="fa fa-code fa-lg"></i>',indent:'<i class="fa fa-indent"></i>',outdent:'<i class="fa fa-outdent"></i>'}:"object"==typeof e&&(t=e),"object"==typeof t)for(n in t)t.hasOwnProperty(n)&&(r[n]=t[n]);return r},initToolbar:function(){return this.toolbar?this:(this.toolbar=this.createToolbar(),this.keepToolbarAlive=!1,this.anchorForm=this.toolbar.querySelector(".medium-editor-toolbar-form-anchor"),this.anchorInput=this.anchorForm.querySelector("input"),this.toolbarActions=this.toolbar.querySelector(".medium-editor-toolbar-actions"),this.anchorPreview=this.createAnchorPreview(),this)},createToolbar:function(){var e=t.createElement("div");return e.id="medium-editor-toolbar-"+this.id,e.className="medium-editor-toolbar",e.appendChild(this.toolbarButtons()),e.appendChild(this.toolbarFormAnchor()),this.options.elementsContainer.appendChild(e),e},toolbarButtons:function(){var e,n,r,o,i=this.options.buttons,a=t.createElement("ul");for(a.id="medium-editor-toolbar-actions",a.className="medium-editor-toolbar-actions clearfix",n=0;n<i.length;n+=1)this.options.extensions.hasOwnProperty(i[n])?(o=this.options.extensions[i[n]],r=void 0!==o.getButton?o.getButton():null):r=this.buttonTemplate(i[n]),r&&(e=t.createElement("li"),s(r)?e.appendChild(r):e.innerHTML=r,a.appendChild(e));return a},toolbarFormAnchor:function(){var e=t.createElement("div"),n=t.createElement("input"),r=t.createElement("a");return r.setAttribute("href","#"),r.innerHTML="&times;",n.setAttribute("type","text"),n.setAttribute("placeholder",this.options.anchorInputPlaceholder),e.className="medium-editor-toolbar-form-anchor",e.id="medium-editor-toolbar-form-anchor",e.appendChild(n),e.appendChild(r),e},bindSelect:function(){var e,n=this,r="";for(this.checkSelectionWrapper=function(e){return e&&n.clickingIntoArchorForm(e)?!1:(clearTimeout(r),void(r=setTimeout(function(){n.checkSelection()},n.options.delay)))},t.documentElement.addEventListener("mouseup",this.checkSelectionWrapper),e=0;e<this.elements.length;e+=1)this.elements[e].addEventListener("keyup",this.checkSelectionWrapper),this.elements[e].addEventListener("blur",this.checkSelectionWrapper);return this},checkSelection:function(){var t,n;return this.keepToolbarAlive===!0||this.options.disableToolbar||(t=e.getSelection(),""===t.toString().trim()||this.options.allowMultiParagraphSelection===!1&&this.hasMultiParagraphs()?this.hideToolbarActions():(n=this.getSelectionElement(),!n||n.getAttribute("data-disable-toolbar")?this.hideToolbarActions():this.checkSelectionElement(t,n))),this},clickingIntoArchorForm:function(e){var t=this;return e.type&&"blur"===e.type.toLowerCase()&&e.relatedTarget&&e.relatedTarget===t.anchorInput?!0:!1},hasMultiParagraphs:function(){var e=a().replace(/<[\S]+><\/[\S]+>/gim,""),t=e.match(/<(p|h[0-6]|blockquote)>([\s\S]*?)<\/(p|h[0-6]|blockquote)>/g);return t?t.length:0},checkSelectionElement:function(e,t){var n;for(this.selection=e,this.selectionRange=this.selection.getRangeAt(0),n=0;n<this.elements.length;n+=1)if(this.elements[n]===t)return void this.setToolbarButtonStates().setToolbarPosition().showToolbarActions();this.hideToolbarActions()},getSelectionElement:function(){var t,n,r,o,i=e.getSelection(),a=function(e){var t=e;try{for(;!t.getAttribute("data-medium-element");)t=t.parentNode}catch(n){return!1}return t};try{t=i.getRangeAt(0),n=t.commonAncestorContainer,r=n.parentNode,o=n.getAttribute("data-medium-element")?n:a(r)}catch(s){o=a(r)}return o},setToolbarPosition:function(){var t=50,n=e.getSelection(),r=n.getRangeAt(0),o=r.getBoundingClientRect(),i=this.options.diffLeft-this.toolbar.offsetWidth/2,a=(o.left+o.right)/2,s=this.toolbar.offsetWidth/2;return o.top<t?(this.toolbar.classList.add("medium-toolbar-arrow-over"),this.toolbar.classList.remove("medium-toolbar-arrow-under"),this.toolbar.style.top=t+o.bottom-this.options.diffTop+e.pageYOffset-this.toolbar.offsetHeight+"px"):(this.toolbar.classList.add("medium-toolbar-arrow-under"),this.toolbar.classList.remove("medium-toolbar-arrow-over"),this.toolbar.style.top=o.top+this.options.diffTop+e.pageYOffset-this.toolbar.offsetHeight+"px"),this.toolbar.style.left=s>a?i+s+"px":e.innerWidth-a<s?e.innerWidth+i-s+"px":i+a+"px",this.hideAnchorPreview(),this
},setToolbarButtonStates:function(){var e,t=this.toolbarActions.querySelectorAll("button");for(e=0;e<t.length;e+=1)t[e].classList.remove("medium-editor-button-active");return this.checkActiveButtons(),this},checkActiveButtons:function(){for(var e=Array.prototype.slice.call(this.elements),t=this.getSelectedParentElement();void 0!==t.tagName&&-1===this.parentElements.indexOf(t.tagName.toLowerCase)&&(this.activateButton(t.tagName.toLowerCase()),this.callExtensions("checkState",t),-1===e.indexOf(t));)t=t.parentNode},activateButton:function(e){var t=this.toolbar.querySelector('[data-element="'+e+'"]');null!==t&&-1===t.className.indexOf("medium-editor-button-active")&&(t.className+=" medium-editor-button-active")},bindButtons:function(){var e,t=this.toolbar.querySelectorAll("button"),n=this,r=function(e){e.preventDefault(),e.stopPropagation(),void 0===n.selection&&n.checkSelection(),this.className.indexOf("medium-editor-button-active")>-1?this.classList.remove("medium-editor-button-active"):this.className+=" medium-editor-button-active",this.hasAttribute("data-action")&&n.execAction(this.getAttribute("data-action"),e)};for(e=0;e<t.length;e+=1)t[e].addEventListener("click",r);return this.setFirstAndLastItems(t),this},setFirstAndLastItems:function(e){return e.length>0&&(e[0].className+=" medium-editor-button-first",e[e.length-1].className+=" medium-editor-button-last"),this},execAction:function(n,r){n.indexOf("append-")>-1?(this.execFormatBlock(n.replace("append-","")),this.setToolbarPosition(),this.setToolbarButtonStates()):"anchor"===n?this.triggerAnchorAction(r):"image"===n?t.execCommand("insertImage",!1,e.getSelection()):(t.execCommand(n,!1,null),this.setToolbarPosition())},rangeSelectsSingleNode:function(e){var t=e.startContainer;return t===e.endContainer&&t.hasChildNodes()&&e.endOffset===e.startOffset+1},getSelectedParentElement:function(){var e=null,t=this.selectionRange;return e=this.rangeSelectsSingleNode(t)?t.startContainer.childNodes[t.startOffset]:3===t.startContainer.nodeType?t.startContainer.parentNode:t.startContainer},triggerAnchorAction:function(){var e=this.getSelectedParentElement();return e.tagName&&"a"===e.tagName.toLowerCase()?t.execCommand("unlink",!1,null):"block"===this.anchorForm.style.display?this.showToolbarActions():this.showAnchorForm(),this},execFormatBlock:function(e){var n=this.getSelectionData(this.selection.anchorNode);if("blockquote"===e&&n.el&&"blockquote"===n.el.parentNode.tagName.toLowerCase())return t.execCommand("outdent",!1,null);if(n.tagName===e&&(e="p"),this.isIE){if("blockquote"===e)return t.execCommand("indent",!1,e);e="<"+e+">"}return t.execCommand("formatBlock",!1,e)},getSelectionData:function(e){var t;for(e&&e.tagName&&(t=e.tagName.toLowerCase());e&&-1===this.parentElements.indexOf(t);)e=e.parentNode,e&&e.tagName&&(t=e.tagName.toLowerCase());return{el:e,tagName:t}},getFirstChild:function(e){for(var t=e.firstChild;null!==t&&1!==t.nodeType;)t=t.nextSibling;return t},hideToolbarActions:function(){this.keepToolbarAlive=!1,void 0!==this.toolbar&&this.toolbar.classList.remove("medium-editor-toolbar-active")},showToolbarActions:function(){var e,t=this;this.anchorForm.style.display="none",this.toolbarActions.style.display="block",this.keepToolbarAlive=!1,clearTimeout(e),e=setTimeout(function(){t.toolbar&&!t.toolbar.classList.contains("medium-editor-toolbar-active")&&t.toolbar.classList.add("medium-editor-toolbar-active")},100)},showAnchorForm:function(e){this.toolbarActions.style.display="none",this.savedSelection=r(),this.anchorForm.style.display="block",this.keepToolbarAlive=!0,this.anchorInput.focus(),this.anchorInput.value=e||""},bindAnchorForm:function(){var e=this.anchorForm.querySelector("a"),t=this;return this.anchorForm.addEventListener("click",function(e){e.stopPropagation()}),this.anchorInput.addEventListener("keyup",function(e){13===e.keyCode&&(e.preventDefault(),t.createLink(this))}),this.anchorInput.addEventListener("click",function(e){e.stopPropagation(),t.keepToolbarAlive=!0}),this.anchorInput.addEventListener("blur",function(){t.keepToolbarAlive=!1,t.checkSelection()}),e.addEventListener("click",function(e){e.preventDefault(),t.showToolbarActions(),o(t.savedSelection)}),this},hideAnchorPreview:function(){this.anchorPreview.classList.remove("medium-editor-anchor-preview-active")},showAnchorPreview:function(t){if(this.anchorPreview.classList.contains("medium-editor-anchor-preview-active"))return!0;var n,r,o,i=this,a=40,s=t.getBoundingClientRect(),u=(s.left+s.right)/2;return i.anchorPreview.querySelector("i").textContent=t.href,n=i.anchorPreview.offsetWidth/2,r=i.options.diffLeft-n,clearTimeout(o),o=setTimeout(function(){i.anchorPreview&&!i.anchorPreview.classList.contains("medium-editor-anchor-preview-active")&&i.anchorPreview.classList.add("medium-editor-anchor-preview-active")},100),i.observeAnchorPreview(t),i.anchorPreview.classList.add("medium-toolbar-arrow-over"),i.anchorPreview.classList.remove("medium-toolbar-arrow-under"),i.anchorPreview.style.top=Math.round(a+s.bottom-i.options.diffTop+e.pageYOffset-i.anchorPreview.offsetHeight)+"px",i.anchorPreview.style.left=n>u?r+n+"px":e.innerWidth-u<n?e.innerWidth+r-n+"px":r+u+"px",this},observeAnchorPreview:function(e){var t=this,n=(new Date).getTime(),r=!0,o=function(){n=(new Date).getTime(),r=!0},i=function(e){e.relatedTarget&&/anchor-preview/.test(e.relatedTarget.className)||(r=!1)},a=setInterval(function(){if(r)return!0;var s=(new Date).getTime()-n;s>t.options.anchorPreviewHideDelay&&(t.hideAnchorPreview(),clearInterval(a),t.anchorPreview.removeEventListener("mouseover",o),t.anchorPreview.removeEventListener("mouseout",i),e.removeEventListener("mouseover",o),e.removeEventListener("mouseout",i))},200);t.anchorPreview.addEventListener("mouseover",o),t.anchorPreview.addEventListener("mouseout",i),e.addEventListener("mouseover",o),e.addEventListener("mouseout",i)},createAnchorPreview:function(){var e=this,n=t.createElement("div");return n.id="medium-editor-anchor-preview-"+this.id,n.className="medium-editor-anchor-preview",n.innerHTML=this.anchorPreviewTemplate(),this.options.elementsContainer.appendChild(n),n.addEventListener("click",function(){e.anchorPreviewClickHandler()}),n},anchorPreviewTemplate:function(){return'<div class="medium-editor-toolbar-anchor-preview" id="medium-editor-toolbar-anchor-preview">    <i class="medium-editor-toolbar-anchor-preview-inner"></i></div>'},anchorPreviewClickHandler:function(){if(this.activeAnchor){var n=this,r=t.createRange(),o=e.getSelection();r.selectNodeContents(n.activeAnchor),o.removeAllRanges(),o.addRange(r),setTimeout(function(){n.activeAnchor&&n.showAnchorForm(n.activeAnchor.href),n.keepToolbarAlive=!1},100+n.options.delay)}this.hideAnchorPreview()},editorAnchorObserver:function(e){var t=this,n=!0,r=function(){n=!1,t.activeAnchor.removeEventListener("mouseout",r)};if(e.target&&"a"===e.target.tagName.toLowerCase()){if(!/href=["']\S+["']/.test(e.target.outerHTML)||/href=["']#\S+["']/.test(e.target.outerHTML))return!0;if(this.toolbar.classList.contains("medium-editor-toolbar-active"))return!0;this.activeAnchor=e.target,this.activeAnchor.addEventListener("mouseout",r),setTimeout(function(){n&&t.showAnchorPreview(e.target)},t.options.delay)}},bindAnchorPreview:function(){var e,t=this;for(this.editorAnchorObserverWrapper=function(e){t.editorAnchorObserver(e)},e=0;e<this.elements.length;e+=1)this.elements[e].addEventListener("mouseover",this.editorAnchorObserverWrapper);return this},checkLinkFormat:function(e){var t=/^https?:\/\//;return e.match(t)?e:"http://"+e},setTargetBlank:function(){var e,t=i();if("a"===t.tagName.toLowerCase())t.target="_blank";else for(t=t.getElementsByTagName("a"),e=0;e<t.length;e+=1)t[e].target="_blank"},createLink:function(e){o(this.savedSelection),this.options.checkLinkFormat&&(e.value=this.checkLinkFormat(e.value)),t.execCommand("createLink",!1,e.value),this.options.targetBlank&&this.setTargetBlank(),this.checkSelection(),this.showToolbarActions(),e.value=""},bindWindowActions:function(){var t,n=this;return this.windowResizeHandler=function(){clearTimeout(t),t=setTimeout(function(){n.toolbar&&n.toolbar.classList.contains("medium-editor-toolbar-active")&&n.setToolbarPosition()},100)},e.addEventListener("resize",this.windowResizeHandler),this},activate:function(){this.isActive||this.setup()},deactivate:function(){var n;if(this.isActive)for(this.isActive=!1,void 0!==this.toolbar&&(this.options.elementsContainer.removeChild(this.anchorPreview),this.options.elementsContainer.removeChild(this.toolbar),delete this.toolbar,delete this.anchorPreview),t.documentElement.removeEventListener("mouseup",this.checkSelectionWrapper),e.removeEventListener("resize",this.windowResizeHandler),n=0;n<this.elements.length;n+=1)this.elements[n].removeEventListener("mouseover",this.editorAnchorObserverWrapper),this.elements[n].removeEventListener("keyup",this.checkSelectionWrapper),this.elements[n].removeEventListener("blur",this.checkSelectionWrapper),this.elements[n].removeEventListener("paste",this.pasteWrapper),this.elements[n].removeAttribute("contentEditable"),this.elements[n].removeAttribute("data-medium-element")},htmlEntities:function(e){return String(e).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")},bindPaste:function(){var e,n=this;for(this.pasteWrapper=function(e){var r,o,i="";if(this.classList.remove("medium-editor-placeholder"),!n.options.forcePlainText&&!n.options.cleanPastedHTML)return this;if(e.clipboardData&&e.clipboardData.getData&&!e.defaultPrevented){if(e.preventDefault(),n.options.cleanPastedHTML&&e.clipboardData.getData("text/html"))return n.cleanPaste(e.clipboardData.getData("text/html"));if(n.options.disableReturn||this.getAttribute("data-disable-return"))t.execCommand("insertHTML",!1,e.clipboardData.getData("text/plain"));else{for(r=e.clipboardData.getData("text/plain").split(/[\r\n]/g),o=0;o<r.length;o+=1)""!==r[o]&&(i+=navigator.userAgent.match(/firefox/i)&&0===o?n.htmlEntities(r[o]):"<p>"+n.htmlEntities(r[o])+"</p>");t.execCommand("insertHTML",!1,i)}}},e=0;e<this.elements.length;e+=1)this.elements[e].addEventListener("paste",this.pasteWrapper);return this},setPlaceholders:function(){var e,t=function(e){e.querySelector("img")||""!==e.textContent.replace(/^\s+|\s+$/g,"")||e.classList.add("medium-editor-placeholder")},n=function(e){this.classList.remove("medium-editor-placeholder"),"keypress"!==e.type&&t(this)};for(e=0;e<this.elements.length;e+=1)t(this.elements[e]),this.elements[e].addEventListener("blur",n),this.elements[e].addEventListener("keypress",n);return this},cleanPaste:function(e){var n,r,o,i=this.getSelectionElement(),a=/<p|<br|<div/.test(e),s=[[new RegExp(/<[^>]*docs-internal-guid[^>]*>/gi),""],[new RegExp(/<\/b>(<br[^>]*>)?$/gi),""],[new RegExp(/<span class="Apple-converted-space">\s+<\/span>/g)," "],[new RegExp(/<br class="Apple-interchange-newline">/g),"<br>"],[new RegExp(/<span[^>]*(font-style:italic;font-weight:bold|font-weight:bold;font-style:italic)[^>]*>/gi),'<span class="replace-with italic bold">'],[new RegExp(/<span[^>]*font-style:italic[^>]*>/gi),'<span class="replace-with italic">'],[new RegExp(/<span[^>]*font-weight:bold[^>]*>/gi),'<span class="replace-with bold">'],[new RegExp(/&lt;(\/?)(i|b|a)&gt;/gi),"<$1$2>"],[new RegExp(/&lt;a\s+href=(&quot;|&rdquo;|&ldquo;|â€œ|â€)([^&]+)(&quot;|&rdquo;|&ldquo;|â€œ|â€)&gt;/gi),'<a href="$2">']];for(n=0;n<s.length;n+=1)e=e.replace(s[n][0],s[n][1]);if(a)for(r=e.split("<br><br>"),this.pasteHTML("<p>"+r.join("</p><p>")+"</p>"),t.execCommand("insertText",!1,"\n"),r=i.querySelectorAll("p,div,br"),n=0;n<r.length;n+=1)switch(o=r[n],o.tagName.toLowerCase()){case"p":case"div":this.filterCommonBlocks(o);break;case"br":this.filterLineBreak(o)}else this.pasteHTML(e)},pasteHTML:function(e){var n,r,o,i,a=t.createDocumentFragment();for(a.appendChild(t.createElement("body")),i=a.querySelector("body"),i.innerHTML=e,this.cleanupSpans(i),n=i.querySelectorAll("*"),o=0;o<n.length;o+=1)r=n[o],r.removeAttribute("class"),r.removeAttribute("style"),r.removeAttribute("dir"),"meta"===r.tagName.toLowerCase()&&r.parentNode.removeChild(r);t.execCommand("insertHTML",!1,i.innerHTML.replace(/&nbsp;/g," "))},isCommonBlock:function(e){return e&&("p"===e.tagName.toLowerCase()||"div"===e.tagName.toLowerCase())},filterCommonBlocks:function(e){/^\s*$/.test(e.innerText)&&e.parentNode.removeChild(e)},filterLineBreak:function(e){this.isCommonBlock(e.previousElementSibling)?e.parentNode.removeChild(e):!this.isCommonBlock(e.parentNode)||e.parentNode.firstChild!==e&&e.parentNode.lastChild!==e?1===e.parentNode.childElementCount&&this.removeWithParent(e):e.parentNode.removeChild(e)},removeWithParent:function(e){e&&e.parentNode&&(e.parentNode.parentNode&&1===e.parentNode.childElementCount?e.parentNode.parentNode.removeChild(e.parentNode):e.parentNode.removeChild(e.parentNode))},cleanupSpans:function(e){var n,r,o,i=e.querySelectorAll(".replace-with");for(n=0;n<i.length;n+=1)r=i[n],o=t.createElement(r.classList.contains("bold")?"b":"i"),o.innerHTML=r.classList.contains("bold")&&r.classList.contains("italic")?"<i>"+r.innerHTML+"</i>":r.innerHTML,r.parentNode.replaceChild(o,r);for(i=e.querySelectorAll("span"),n=0;n<i.length;n+=1)r=i[n],/^\s*$/.test()?r.parentNode.removeChild(r):r.parentNode.replaceChild(t.createTextNode(r.innerText),r)}}}(window,document);