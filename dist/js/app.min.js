Function.prototype.bind||(Function.prototype.bind=function(e){if("function"!=typeof this)throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var o=Array.prototype.slice.call(arguments,1),t=this,n=function(){},r=function(){var r=this instanceof n&&e?this:e,i=o.concat(Array.prototype.slice.call(arguments));return t.apply(r,i)};return n.prototype=this.prototype,r.prototype=new n,r});var GIVE_UP_DELAY=1e4;!function(){var e,o={dev:{host:"localhost:3000"},test:{host:"test.api.mondora.com"},prod:{host:"api.mondora.com",ssl:!0}};e=/b/.test(APP_VERSION)?o.dev:/t/.test(APP_VERSION)?o.test:o.prod;var t=Q.defer();window.Ceres=new Asteroid(e.host,e.ssl,e.debug),Ceres.on("connected",function(){t.resolve()}),Ceres.ddp.on("socket_close",function(){console.log("Closed")}),window.CERES_CONNECTED=t.promise.timeout(GIVE_UP_DELAY)}(),angular.module("mnd-web",["ui.bootstrap","ui.router","mnd.sprinkle","mnd.dashboard","angularFileUpload","ngSanitize","RecursionHelper","mnd-web.templates","mnd-web.methods","mnd-web.components.dashboard","mnd-web.components.mindmap","mnd-web.components.center","mnd-web.components.check-mobile","mnd-web.components.clear-selection","mnd-web.components.menu-editor","mnd-web.components.cig-image","mnd-web.components.pomodoro","mnd-web.components.user-input","mnd-web.pages.home","mnd-web.pages.staticHome","mnd-web.pages.personalHome","mnd-web.pages.profile","mnd-web.pages.page","mnd-web.pages.admin","mnd-web.pages.pomodoro.list","mnd-web.pages.pomodoro.view","mnd-web.pages.team","mnd-web.pages.user","mnd-web.pages.post.edit","mnd-web.pages.post.view","mnd-web.pages.post.list","mnd-web.pages.channel.edit","mnd-web.pages.channel.view","mnd-web.pages.topic"]).factory("TimeoutPromiseService",function(e,o,t){var n=function(n,r){var i=e.defer(),a=o(function(){i.reject("timeout"),t.go("serverProblems")},r);return n.then(function(e){o.cancel(a),i.resolve(e)},function(e){o.cancel(a),i.reject(e),t.go("serverProblems")}),i.promise};return{timeoutPromise:n}}).config(function(e){e.hashPrefix("!")}).config(function(e,o){e.state("root",{"abstract":!0,templateUrl:"root.html",resolve:{resumingLogin:function(e,o){return CERES_CONNECTED.then(function(){var o=Ceres.resumeLoginPromise;return o.isPending()?e.timeoutPromise(o,GIVE_UP_DELAY).finally(function(){return!0}):!0}).then(function(){var o=Ceres.subscribe("configurations");return e.timeoutPromise(o.ready,GIVE_UP_DELAY)}).fail(function(){o.go("staticHome")})}}}),e.state("home",{url:"/",parent:"root",templateUrl:"pages/home/home.html",controller:"HomeController",onEnter:function(e,o){e.user&&o.go("personalHome")},"public":!0}),e.state("staticHome",{url:"/staticHome",templateUrl:"pages/staticHome/staticHome.html",controller:"StaticHomeController","public":!0}),e.state("approach",{url:"/approach",parent:"root",templateUrl:"pages/page/page.html",resolve:{},controller:"PageController","public":!0}),e.state("personalHome",{url:"/home",parent:"root",templateUrl:"pages/personalHome/personalHome.html",controller:"PersonalHomeController"}),e.state("notFound",{url:"/notFound",parent:"root",templateUrl:"pages/notFound/notFound.html","public":!0}),e.state("serverProblems",{url:"/serverProblems",parent:"root",templateUrl:"pages/serverProblems/serverProblems.html","public":!0}),e.state("profile",{url:"/profile",parent:"root",templateUrl:"pages/profile/profile.html",controller:"ProfileController"}),e.state("admin",{url:"/admin",parent:"root",templateUrl:"pages/admin/admin.html",controller:"AdminController"}),e.state("pomodoroList",{url:"/pomodoro",parent:"root",templateUrl:"pages/pomodoro/list/pomodoroList.html",controller:"PomodoroListController",resolve:{pomoSub:function(e){var o=Ceres.subscribe("pomodoros");return e.timeoutPromise(o.ready,GIVE_UP_DELAY)}}}),e.state("pomodoroView",{url:"/pomodoro/:pomodoroId",parent:"root",templateUrl:"pages/pomodoro/view/pomodoroView.html",controller:"PomodoroViewController",resolve:{pomoSub:function(e,o){var t=Ceres.subscribe("singlePomodoro",o.pomodoroId);return e.timeoutPromise(t.ready,GIVE_UP_DELAY)}}}),e.state("user",{url:"/user/:userId",parent:"root",templateUrl:"pages/user/user.html",controller:"UserController",resolve:{userSub:function(e,o){var t=Ceres.subscribe("singleUser",e.userId);return o.timeoutPromise(t.ready,GIVE_UP_DELAY)},posts:function(e,o){var t=Ceres.call("getPostsByAuthor",o.userId);return e.timeoutPromise(t.result,GIVE_UP_DELAY)}},"public":!0}),e.state("team",{url:"/team",parent:"root",templateUrl:"pages/team/team.html",controller:"TeamController",resolve:{userSub:function(e){var o=Ceres.subscribe("teamUsers");return e.timeoutPromise(o.ready,GIVE_UP_DELAY)}},"public":!0}),e.state("postView",{url:"/post/:postId",parent:"root",templateUrl:"pages/post/view/postView.html",controller:"PostViewController",resolve:{postSub:function(e,o){var t=Ceres.subscribe("singlePost",e.postId);return o.timeoutPromise(t.ready,GIVE_UP_DELAY)}},"public":!0}),e.state("postEdit",{url:"/post/:postId/edit",parent:"root",templateUrl:"pages/post/edit/postEdit.html",controller:"PostEditController",resolve:{postSub:function(e,o){var t=Ceres.subscribe("singlePost",e.postId);return o.timeoutPromise(t.ready,GIVE_UP_DELAY)}}}),e.state("postList",{url:"/posts",parent:"root",templateUrl:"pages/post/list/postList.html",controller:"PostListController",resolve:{postSub:function(e){var o=Ceres.subscribe("latestPosts");return e.timeoutPromise(o.ready,GIVE_UP_DELAY)}},"public":!0}),e.state("topic",{url:"/topic/:name",parent:"root",templateUrl:"pages/topic/topic.html",controller:"TopicController",resolve:{topic:function(e,o){var t=Ceres.call("getTopic",o.name);return e.timeoutPromise(t.result,GIVE_UP_DELAY)}},"public":!0}),o.otherwise("/")}).run(function(e,o,t){e.safeApply=function(o){var t=e.$$phase;"$apply"===t||"$digest"===t?"function"==typeof o&&o():this.$apply(o)},e.Ceres=Ceres,Ceres.subscribe("userAdditionalInfo"),Ceres.subscribe("allUsers"),e.Configurations=Ceres.createCollection("configurations"),e.Posts=Ceres.createCollection("posts"),e.Channels=Ceres.createCollection("channels"),e.Users=Ceres.createCollection("users"),Ceres.on("login",function(o){e.loggedInUserQuery=e.Users.reactiveQuery({_id:o}),e.safeApply(function(){e.user=e.loggedInUserQuery.result[0],e.signedIn=!0}),e.loggedInUserQuery.on("change",function(){e.safeApply(function(){e.user=e.loggedInUserQuery.result[0]})})}),Ceres.on("logout",function(){e.safeApply(function(){delete e.user,e.signedIn=!1,o.current.public||o.go("home")})}),e.$on("$stateChangeStart",function(n,r){t.getSidebarStatus()&&t.toggleSidebarStatus(),e.$broadcast("sidebarStatusChanged"),"home"===r.name&&e.user&&(n.preventDefault(),o.go("personalHome"))})}).controller("MainController",function(e){e.login=function(){e.Ceres.loginWithTwitter()},e.logout=function(){e.Ceres.logout()}}),angular.module("mnd-web.methods",[]).factory("AppMethods",function(e,o){var t=function(){var t=e.user;if(t){var n={userId:t._id,map:{},authors:[{userId:t._id,screenName:t.profile.screenName,name:t.profile.name,pictureUrl:t.profile.pictureUrl}],comments:[],published:!1};e.Posts.insert(n).remote.then(function(e){o.go("postEdit",{postId:e})},function(e){console.log(e)})}},n=function(){var t=e.user;if(t){var n={userId:t._id,curators:[{userId:t._id,screenName:t.profile.screenName,name:t.profile.name,pictureUrl:t.profile.pictureUrl}],groups:[],members:[]};e.Channels.insert(n).remote.then(function(e){o.go("channelEdit",{channelId:e})},function(e){console.log(e)})}},r=function(){};return{addPost:t,addChannel:n,noop:r}}),angular.module("mnd-web.components.center",[]).directive("mndCenter",function(e){return{restrict:"A",priority:1e3,compile:function(){return{post:function(o,t){e(function(){var e=t[0],o=e.parentElement,n=parseInt(window.getComputedStyle(e).width,10),r=o.offsetWidth,i=(r-n)/2-50;e.style.marginLeft=i+"px"},0)}}}}}),angular.module("mnd-web.components.check-mobile",[]).factory("CheckMobileService",function(){return{isMobile:function(){var e=document.getElementsByTagName("body")[0],o=parseInt(window.getComputedStyle(e).width,10),t=/Android|webOS|iPhone|iPad|iPod|BlackBerry|Windows Phone/i.test(navigator.userAgent),n=767>o;return t||n}}}),angular.module("mnd-web.components.cig-image",[]).directive("mndCigImage",function(){return{restrict:"EA",scope:{source:"=",size:"@"},link:function(e,o){var t=parseInt(e.size,10),n=t/20;1>n&&(n=1),n>6&&(n=6),o.addClass("picture-circle-in-grey");var r=function(){var r=new Image;r.addEventListener("load",function(){if(!e.imageLoaded){e.imageLoaded=!0,o.empty(),r.width>=r.height?r.height=t:r.width=t,o.append(r);var i=window.getComputedStyle(r),a=(parseFloat(i.height,10)-t)/-2-n;isNaN(a)||(r.style.top=a+"px");var l=(parseFloat(i.width,10)-t)/-2-n;isNaN(l)||(r.style.left=l+"px")}},!1),r.src=e.source};e.$watch("source",function(){e.imageLoaded=!1,r()}),o.css({width:t+"px",height:t+"px","border-width":n+"px"})}}}),angular.module("mnd-web.components.clear-selection",[]).factory("ClearWindowSelectionService",function(){var e=function(){window.getSelection?window.getSelection().empty?window.getSelection().empty():window.getSelection().removeAllRanges&&window.getSelection().removeAllRanges():document.selection&&document.selection.empty()};return{clear:e}}),angular.module("mnd-web.components.dashboard",[]).controller("SidebarController",function(e,o,t){e.actions=t;var n=function(){var o=e.user,t=[];return i.items.forEach(function(e){if(!e.loginRequired||o){if(e.roles){if(!o||!o.roles)return;var n=o.roles.reduce(function(o,t,n,r){return o?-1===e.roles.indexOf(r[n]):o},!0);if(n)return}t.push(e)}}),{items:t}},r=e.Configurations.reactiveQuery({name:"menu"}),i=r.result[0];r.on("change",function(){e.safeApply(function(){i=r.result[0],e.menu=n()})}),e.$watch("user",function(){e.menu=n()})}),angular.module("mnd-web.components.menu-editor",[]).directive("mndMenuEditor",function(e){return{restrict:"EA",templateUrl:"components/menu-editor/menu-editor.html",scope:{items:"="},link:function(o){o.availableActions=Object.keys(e),o.menu={moveUp:function(e,t){t.stopPropagation();var n=o.items[e];o.items.splice(e,1),o.items.splice(e-1,0,n)},moveDown:function(e,t){t.stopPropagation();var n=o.items[e];o.items.splice(e,1),o.items.splice(e+1,0,n)},moveSubitemUp:function(e,o,t){t.stopPropagation();var n=e.items[o];e.items.splice(o,1),e.items.splice(o-1,0,n)},moveSubitemDown:function(e,o,t){t.stopPropagation();var n=e.items[o];e.items.splice(o,1),e.items.splice(o+1,0,n)},addItem:function(){o.items.push({title:"Your title here",type:"link"})},addSubitem:function(e){e.items=e.items||[],e.items.push({title:"Your title here",type:"link"})},deleteItem:function(e){o.items.splice(e,1)},deleteSubitem:function(e,o){e.items.splice(o,1)}}}}}),angular.module("mnd-web.components.mindmap",[]).directive("mndMindMapRecursive",function(e){return{restrict:"EA",replace:!0,templateUrl:"components/mindmap/mindmaprecursive.html",scope:{map:"=",edit:"=?",child:"=?"},compile:function(o){return e.compile(o,function(e){e.autodestroy=function(){if(e.child){var o=e.$parent.$parent.map.children,t=o.indexOf(e.map);o.splice(t,1)}},e.addChild=function(){e.map||(e.map={}),e.map.children||(e.map.children=[]),e.map.children.push({})}})}}}).directive("mndMindMap",function(){return{restrict:"EA",replace:!0,templateUrl:"components/mindmap/mindmap.html",scope:{map:"=",edit:"=?",child:"=?"}}}),angular.module("mnd-web.components.pomodoro",[]).factory("PomodoroService",function(e){var o=(e.Ceres.createCollection("pomodoros"),function(o){return e.Ceres.call("startPomodoro",o._id)}),t=function(o){return e.Ceres.call("pausePomodoro",o._id)},n=function(o){return e.Ceres.call("stopPomodoro",o._id)},r=function(o,t){return e.Ceres.call("addPomodoroParticipant",o._id,t)},i=function(o,t){return e.Ceres.call("setPomodoroDuration",o._id,t)},a=function(e){return e.events.reduce(function(e,o,t,n){return t%2===1?e+=n[t].time-n[t-1].time:t===n.length-1?e+=Date.now()-n[t].time:e},0)},l=function(e){var o=a(e),t=e.duration-o;return 1e3>t&&(t=0),t};return{start:o,pause:t,stop:n,addParticipant:r,setDuration:i,calculateRemaining:l}}).directive("mndPomodoroTimer",function(e,o){return{restrict:"EA",templateUrl:"components/pomodoro/pomodoro-timer.html",replace:!0,scope:{pomodoro:"=",size:"@?"},link:function(t,n){var r=parseInt(t.size||"100",10),i=r/2;t.format="mm:ss";var a=n.find("svg"),l=n.find("path"),s=n.find("circle"),u=n.find("div");n.css({width:r+"px",height:r+"px"}),a.attr("width",r),a.attr("height",r),a.attr("viewbox","0 0 "+r+" "+r),l.attr("transform","translate("+i+", "+i+")"),s.attr("r",.7*i),s.attr("transform","translate("+i+", "+i+")"),u.css({height:r+"px","line-height":r+"px","font-size":.2*r+"px"});var c=function(){if(0===t.remaining)return l.remove(),void s.attr("r",i);var e=2*(1-t.remaining/t.pomodoro.duration)*Math.PI,o=Math.sin(e)*i,n=Math.cos(e)*i*-1,r=e>Math.PI?1:0,a="M 0 0 v -"+i+" A "+i+" "+i+" 1 "+r+" 1 "+o+" "+n+" z";l.attr("d",a)},m=function(){t.remaining=o.calculateRemaining(t.pomodoro),c()};m();var d;t.$watch("pomodoro.status",function(n){"running"===n?d=e(function(){m(),0===t.remaining&&(e.cancel(d),o.stop(t.pomodoro))},1e3):"puased"===n?e.cancel(d):"stopped"===n&&(e.cancel(d),t.remaining=0)}),t.$on("$destroy",function(){e.cancel(d)})}}}).directive("mndPomodoroSummary",function(){return{restrict:"EA",templateUrl:"components/pomodoro/pomodoro-summary.html",replace:!0}}),angular.module("mnd-web.components.user-input",[]).filter("filterByNameAndScreenName",function(){return function(e,o){var t=[],n=new RegExp(o,"i");return e.forEach(function(e){e.profile&&(n.test(e.profile.name)||n.test(e.profile.screenName))&&t.push(e)}),t}}).directive("mndUserInput",function(e,o){return{restrict:"A",terminal:!0,priority:1e3,scope:{userModel:"="},controller:function(o){var t=e.Users.reactiveQuery({});t.on("change",function(){o.users=t.result}),o.users=t.result},compile:function(e){return e.attr("ng-model","userModel"),e.attr("typeahead","user as user.profile.name for user in users | filterByNameAndScreenName : $viewValue"),e.attr("typeahead-template-url","components/user-input/user-input.html"),e.removeAttr("mnd-user-input"),e.removeAttr("data-mnd-user-input"),{pre:function(){},post:function(e,t){o(t)(e)}}}}}),angular.module("mnd-web.pages.admin",[]).controller("AdminController",function(e,o){e.amazonS3Config=e.Configurations.reactiveQuery({name:"amazonS3"}).result[0],e.homeConfig=e.Configurations.reactiveQuery({name:"home"}).result[0],e.menuConfig=e.Configurations.reactiveQuery({name:"menu"}).result[0];var t=angular.copy(e.menuConfig);delete t._id;var n=angular.copy(e.homeConfig);delete n._id;var r=angular.copy(e.amazonS3Config);delete r._id,e.save=function(){menuConfig=angular.copy(e.menuConfig),delete menuConfig._id,angular.equals(menuConfig,t)||(t=menuConfig,e.Configurations.update(e.menuConfig._id,menuConfig).remote.fail(function(e){console.log(e)})),homeConfig=angular.copy(e.homeConfig),delete homeConfig._id,angular.equals(homeConfig,n)||(n=homeConfig,e.Configurations.update(e.homeConfig._id,homeConfig).remote.fail(function(e){console.log(e)}));var o=angular.copy(e.amazonS3Config);delete o._id,angular.equals(o,r)||(r=o,e.Configurations.update(e.amazonS3Config._id,o).remote.fail(function(e){console.log(e)}))};var i=o(e.save,1e3);e.$on("$destroy",function(){o.cancel(i)})}),angular.module("mnd-web.pages.home",[]).controller("HomeController",function(e,o,t){var n=e.Configurations.reactiveQuery({name:"home"}).result[0];e.sprinkleText=n.sprinkleText,e.banner=n.banner,e.payoff=n.payoff,e.login=function(){e.Ceres.loginWithTwitter().then(function(){t.go("personalHome")})};var r="http://mnd-website.s3.amazonaws.com/Mnd-Alps.mp4";e.videoSource=o.trustAsResourceUrl(r);var i="http://s3.amazonaws.com/mnd-website/vd-back.jpg";e.videoPoster=o.trustAsResourceUrl(i)}),angular.module("mnd-web.pages.page",[]).controller("PageController",function(){}),angular.module("mnd-web.pages.personalHome",[]).controller("PersonalHomeController",function(e){e.isAdmin=function(){return e.user&&Array.isArray(e.user.roles)?-1!==e.user.roles.indexOf("configure"):void 0}}),angular.module("mnd-web.pages.profile",[]).controller("ProfileController",function(e,o,t){var n=e.Configurations.reactiveQuery({name:"amazonS3"}).result[0];e.profile=e.user.profile||{};var r=document.getElementById("profileNameEditor");r.innerHTML=e.profile.name||"";var i={placeholder:"Name",disableToolbar:!0,forcePlainText:!0,disableReturn:!0};new MediumEditor(r,i);var a=document.getElementById("profileScreenNameEditor");a.innerHTML=e.profile.screenName||"";var l={placeholder:"Screen Name",disableToolbar:!0,forcePlainText:!0,disableReturn:!0};new MediumEditor(a,l);var s=document.getElementById("profileEmailEditor");s.innerHTML=e.profile.email||"";var u={placeholder:"Email",disableToolbar:!0,forcePlainText:!0,disableReturn:!0};new MediumEditor(s,u);var c=document.getElementById("profileFacebookEditor");c.innerHTML=e.profile.facebookUrl||"";var m={placeholder:"Facebook profile url",disableToolbar:!0,forcePlainText:!0,disableReturn:!0};new MediumEditor(c,m);var d=document.getElementById("profileTwitterEditor");d.innerHTML=e.profile.twitterUrl||"";var p={placeholder:"Twitter profile url",disableToolbar:!0,forcePlainText:!0,disableReturn:!0};new MediumEditor(d,p);var f=document.getElementById("profileLinkedInEditor");f.innerHTML=e.profile.linkedInUrl||"";var g={placeholder:"LinkedIn profile url",disableToolbar:!0,forcePlainText:!0,disableReturn:!0};new MediumEditor(f,g);var h=document.getElementById("profileGithubEditor");h.innerHTML=e.profile.githubUrl||"";var v={placeholder:"Github profile url",disableToolbar:!0,forcePlainText:!0,disableReturn:!0};new MediumEditor(h,v);var b=document.getElementById("profileMottoEditor");b.innerHTML=e.profile.motto||"";var y={placeholder:"Click to edit",disableToolbar:!0,forcePlainText:!0,disableReturn:!0};new MediumEditor(b,y);var w=document.getElementById("profileBioEditor");w.innerHTML=e.user.profile.bio||"";var C={placeholder:"Click to edit",buttonLabels:"fontawesome",buttons:["bold","italic","anchor","header1","header2","quote"]};new MediumEditor(w,C),e.clickFileInput=function(){document.querySelector("#profilePictureFileInput").click()},e.abortUpload=function(){e.uploadProgress=0,e.isUploading=!1,e.imageUpload.abort(),delete e.imageUpload},e.onFileSelect=function(o){var r=o[0];if(!/image/g.test(r.type))return void alert("Devi caricare un'immagine.");var i=Math.round(1e16*Math.random()),a=i+"__"+r.name,l={url:n.postUrl,method:"POST",data:{key:a,acl:"public-read","Content-Type":r.type},file:r};e.isUploading=!0,e.imageUpload=t.upload(l).progress(function(o){e.uploadProgress=parseInt(100*o.loaded/o.total)}).success(function(){e.uploadProgress=100,e.isUploading=!1,e.profile.pictureUrl=n.getUrl+a,e.save()})};var I=angular.copy(e.profile);e.save=function(){e.profile.bio=w.innerHTML,e.profile.name=r.innerHTML,e.profile.screenName=a.innerHTML,e.profile.email=s.innerHTML,e.profile.motto=b.innerHTML,e.profile.facebookUrl=c.innerHTML,e.profile.twitterUrl=d.innerHTML,e.profile.linkedInUrl=f.innerHTML,e.profile.githubUrl=h.innerHTML;var o=angular.copy(e.profile);angular.equals(o,I)||(I=o,e.Users.update(e.user._id,{profile:o}).remote.fail(function(e){console.log(e)}))};var P=o(e.save,2e3);e.$on("$destroy",function(){o.cancel(P)})}),angular.module("mnd-web.pages.team",[]).controller("TeamController",function(e){var o=e.Users.reactiveQuery({mondoraTeamMember:!0});o.on("change",function(){e.safeApply(function(){e.team=o.result})}),e.team=o.result,e.sendLinkedInProfile=function(o){e.Ceres.call("sendLinkedInProfileUrl",o),e.linkSent=!0},e.checkLink=function(e){return/linkedin\.com/.test(e)}}),angular.module("mnd-web.pages.staticHome",[]).controller("StaticHomeController",function(e,o){e.sprinkleText="Essere al passo con i tempi, concreti e con una stretta e profonda visione tecnologica: questo Ã¨ il modo con il quale ci caratterizziamo";var t="http://mnd-website.s3.amazonaws.com/Mnd-Alps.mp4";e.videoSource=o.trustAsResourceUrl(t);var n="http://s3.amazonaws.com/mnd-website/vd-back.jpg";e.videoPoster=o.trustAsResourceUrl(n)}),angular.module("mnd-web.pages.topic",[]).controller("TopicController",function(e,o){e.topic=o}),angular.module("mnd-web.pages.user",[]).controller("UserController",function(e,o,t){e.user=e.Users.reactiveQuery({_id:o.userId}).result[0],e.posts=t,e.isUser=function(){return e.$root.user._id===e.user._id}}),angular.module("mnd-web.pages.channel.edit",[]).controller("ChannelEditController",function(e,o,t,n,r,i){var a=e.Configurations.reactiveQuery({name:"amazonS3"}).result[0],l=n.channelId;if(e.channel=e.Channels.reactiveQuery({_id:l}).result[0],!e.channel)return void t.go("notFound");e.isMobile=i.isMobile();var s=document.getElementById("channelTitleEditor");s.innerHTML=e.channel.title||"";var u={placeholder:"Titolo",disableToolbar:!0,forcePlainText:!0,disableReturn:!0};new MediumEditor(s,u);var c=document.getElementById("channelSubtitleEditor");c.innerHTML=e.channel.subtitle||"";var m={placeholder:"Sottotitolo",disableToolbar:!0,forcePlainText:!0,disableReturn:!0};new MediumEditor(c,m);var d=document.getElementById("channelBodyEditor");d.innerHTML=e.channel.body||"";var p={placeholder:"Corpo",buttonLabels:"fontawesome",buttons:["bold","italic","anchor","header1","header2","quote"]};new MediumEditor(d,p),e.toggleDelete=function(){e.showDelete=!e.showDelete;var o=document.querySelector("body");angular.element(o).toggleClass("modal-open")},e.deleteChannel=function(){e.Channels.remove(l).remote.then(function(){t.go("home")},function(){alert("An error occurred.")})},e.isOwner=function(){return e.user&&e.channel.userId===e.user._id},e.clickFileInput=function(e){document.getElementById(e).click()},e.isUploading={},e.uploadProgress={};var f={},g={},h={};e.abortUpload=function(o){e.uploadProgress[o]=0,e.isUploading[o]=!1,f[o].abort(),delete f[o]},e.onFileSelect=function(o,t){var n=o[0];if(!/image/g.test(n.type))return void alert("Devi caricare un'immagine.");var i=Math.round(1e16*Math.random()),l=i+"__"+n.name,s={url:a.channelUrl,method:"POST",data:{key:l,acl:"public-read","Content-Type":n.type},file:n},u=a.getUrl;h[t](),e.uploadProgress[t]=0,e.isUploading[t]=!0,f[t]=r.upload(s).progress(function(o){e.uploadProgress[t]=parseInt(100*o.loaded/o.total)}).success(function(){e.uploadProgress[t]=100,e.isUploading[t]=!1,g[t](u+l)})},e.mainImageIsDisplayed=function(){return e.channel?void 0!==e.channel.mainImageUrl:void 0},h.mainImage=function(){},g.mainImage=function(o){e.channel.mainImageUrl=o};var v={title:e.channel.title,subtitle:e.channel.subtitle,body:e.channel.body,mainImageUrl:e.channel.mainImageUrl};e.save=function(){if(!e.dontSave){e.channel.title=s.innerHTML,e.channel.subtitle=c.innerHTML,e.channel.body=d.innerHTML;var o={title:e.channel.title,subtitle:e.channel.subtitle,body:e.channel.body,mainImageUrl:e.channel.mainImageUrl};angular.equals(o,v)||(v=o,e.Channels.update(l,o).remote.fail(function(e){console.log(e)}))}};var b=o(e.save,2500);e.$on("$destroy",function(){o.cancel(b)})}),angular.module("mnd-web.pages.channel.view",[]).controller("ChannelViewController",function(){}),angular.module("mnd-web.pages.pomodoro.list",[]).controller("PomodoroListController",function(e){var o=15e5,t=e.user,n=e.Ceres.createCollection("pomodoros");e.addPomodoro=function(){var e={userId:t._id,participants:[{userId:t._id,screenName:t.profile.screenName,name:t.profile.name,pictureUrl:t.profile.pictureUrl}],events:[],status:"paused",duration:o};n.insert(e).remote.fail(function(e){console.log(e)})};var r=n.reactiveQuery({});r.on("change",function(){e.safeApply(function(){e.pomodoros=r.result})}),e.pomodoros=r.result}),angular.module("mnd-web.pages.pomodoro.view",[]).controller("PomodoroViewController",function(e,o,t){var n=e.Ceres.createCollection("pomodoros"),r=n.reactiveQuery({_id:o.pomodoroId});r.on("change",function(){e.safeApply(function(){e.pomodoro=r.result[0]})}),e.pomodoro=r.result[0],e.addParticipant=function(){t.addParticipant(e.pomodoro,e.participant._id),e.participant=""},e.start=function(){t.start(e.pomodoro)},e.pause=function(){t.pause(e.pomodoro)},e.stop=function(){t.stop(e.pomodoro)};var i=15e3;e.plusFiveMinutes=function(){var o=e.pomodoro.duration+i;t.setDuration(e.pomodoro,o)},e.minusFiveMinutes=function(){if(!(t.calculateRemaining(e.pomodoro)<i)){var o=e.pomodoro.duration-i;t.setDuration(e.pomodoro,o)}}}),angular.module("mnd-web.pages.post.edit",[]).controller("PostEditController",function(e,o,t,n,r,i,a,l,s){var u=e.Configurations.reactiveQuery({name:"amazonS3"}).result[0],c=n.postId;if(e.post=e.Posts.reactiveQuery({_id:c}).result[0],!e.post)return void t.go("notFound");e.isMobile=l.isMobile();var m=document.getElementById("postTitleEditor");m.innerHTML=e.post.title||"";var d={placeholder:"Titolo",disableToolbar:!0,forcePlainText:!0,disableReturn:!0};new MediumEditor(m,d);var p=document.getElementById("postSubtitleEditor");p.innerHTML=e.post.subtitle||"";var f={placeholder:"Sottotitolo",disableToolbar:!0,forcePlainText:!0,disableReturn:!0};new MediumEditor(p,f);var g=document.getElementById("postBodyEditor");g.innerHTML=e.post.body||"";var h={placeholder:"Corpo",buttonLabels:"fontawesome",buttons:["bold","italic","anchor","header1","header2","quote"]};new MediumEditor(g,h),e.toggleDelete=function(){e.showDelete=!e.showDelete;var o=document.querySelector("body");angular.element(o).toggleClass("modal-open")},e.deletePost=function(){e.Posts.remove(c).remote.then(function(){t.go("home")},function(){alert("An error occurred.")})},e.publishPost=function(){e.post.published=!0,e.save()},e.unpublishPost=function(){e.post.published=!1,e.save()},e.isOwner=function(){return e.user&&e.post.userId===e.user._id},e.clickFileInput=function(e){document.getElementById(e).click()},e.isUploading={},e.uploadProgress={};var v={},b={},y={};e.abortUpload=function(o){e.uploadProgress[o]=0,e.isUploading[o]=!1,v[o].abort(),delete v[o]},e.onFileSelect=function(o,t){var n=o[0];if(!/image/g.test(n.type))return void alert("Devi caricare un'immagine.");var r=Math.round(1e16*Math.random()),i=r+"__"+n.name,l={url:u.postUrl,method:"POST",data:{key:i,acl:"public-read","Content-Type":n.type},file:n},s=u.getUrl;y[t](),e.uploadProgress[t]=0,e.isUploading[t]=!0,v[t]=a.upload(l).progress(function(o){e.uploadProgress[t]=parseInt(100*o.loaded/o.total)}).success(function(){e.uploadProgress[t]=100,e.isUploading[t]=!1,b[t](s+i)})},e.titleImageIsDisplayed=function(){return e.post?void 0!==e.post.titleImageUrl:void 0},y.titleImage=function(){},b.titleImage=function(o){e.post.titleImageUrl=o};var w,C,I,P=document.getElementById("rightClickToolbar"),E=document.getElementById("imagePositioningToolbar"),U=r.get("pages/post/edit/progressbar.html"),T=r.get("pages/post/edit/bodyImage.html");y.bodyImage=function(){e.dontSave=!0,I=i(U)(e),w.after(I)},b.bodyImage=function(o){I.remove(),e.dontSave=!1;var t=e.$new();t.url=o;var n=i(T)(t);w.after(n)},g.addEventListener("contextmenu",function(e){if("IMG"!==e.toElement.tagName){w=angular.element(e.toElement),e.preventDefault(),s.clear(),P.style.display="block";var o=window.getComputedStyle(P),t=parseInt(o.width,10),n=parseInt(o.height,10);P.style.top=e.layerY-(n+20)+"px",P.style.left=e.layerX-t/2+"px";var r=function(){P.style.display="none",document.removeEventListener("click",r)};document.addEventListener("click",r)}}),g.addEventListener("click",function(e){if("IMG"===e.toElement.tagName){C=angular.element(e.toElement),E.style.display="block";var o=window.getComputedStyle(E),t=parseInt(o.width,10),n=parseInt(o.height,10);window.a=C,E.style.top=C[0].offsetTop-(n+20)+"px",E.style.left=C[0].offsetLeft+C[0].clientWidth/2-t/2+"px";var r=function(e){"IMG"!==e.toElement.tagName&&(E.style.display="none",document.removeEventListener("click",r))};setTimeout(function(){document.addEventListener("click",r)},100)}}),e.moveImage={left:function(){C.removeClass("bodyImageLeft bodyImageCenter bodyImageRight"),C.addClass("bodyImageLeft")},center:function(){C.removeClass("bodyImageLeft bodyImageCenter bodyImageRight"),C.addClass("bodyImageCenter")},right:function(){C.removeClass("bodyImageLeft bodyImageCenter bodyImageRight"),C.addClass("bodyImageRight")}},e.removeImage=function(){C.remove()};var M=function(e,o){o&&(e.href&&"/#!/topic/"!==e.href.slice(0,10)?"http://"!==e.href.slice(0,7)&&(e.href="http://"+e.href):e.href="/#!/topic/"+e.text),e.children&&e.children.map(function(e){M(e,!0)})},L=angular.copy(e.post);delete L._id,delete L.userId,delete L.authors,e.save=function(){if(!e.dontSave){e.post.title=m.innerHTML,e.post.subtitle=p.innerHTML,e.post.body=g.innerHTML,M(e.post.map);var o=angular.copy(e.post);delete o._id,delete o.userId,delete o.authors,angular.equals(o,L)||(L=o,e.Posts.update(c,o).remote.fail(function(e){console.log(e)}))}};var S=o(e.save,2500);e.$on("$destroy",function(){o.cancel(S)})}),angular.module("mnd-web.pages.post.list",[]).controller("PostListController",function(e){e.posts=e.Posts.reactiveQuery({})}),angular.module("mnd-web.pages.post.view",[]).factory("firstLevelHtmlParser",function(){var e=function(e){var o=document.createElement("div");o.innerHTML=e;var t=Array.prototype.map.call(o.children,function(e){return e.outerHTML});return t};return{parse:e}}).directive("readonlyEditor",function(e){var o=function(o){this.button=document.createElement("button"),this.button.className="medium-editor-action",this.button.innerHTML='<i class="fa fa-twitter"></i>',this.button.onclick=function(){var t="https://twitter.com/intent/tweet?text=",n='"'+window.getSelection().toString()+'" - @';n+=o+" "+window.location.href;var r=t+n,i=window.open(r,"popup","height=420,width=550");e.clear(),i.focus||i.focus()}};o.prototype.constructor=o,o.prototype.getButton=function(){return this.button};var t=function(o){this.button=document.createElement("button"),this.button.className="medium-editor-action",this.button.innerHTML='<i class="fa fa-comment"></i>',this.button.onclick=function(){o.safeApply(function(){o.closeCommentBar(),o.openCommentBarAt(o.$index),o.comment.anchor=window.getSelection().toString(),e.clear()})}};return t.prototype.constructor=t,t.prototype.getButton=function(){return this.button},{link:function(e,n){var r={placeholder:"",disableEditing:!0,buttons:["tweet","highlight"],extensions:{tweet:new o(e.post.authors[0].screenName),highlight:new t(e)}};n[0].innerHTML=e.child,new MediumEditor(n[0],r)}}}).filter("filterCommentsByParagraph",function(){return function(e,o){var t=[];return e.forEach(function(e){e.paragraph===o&&t.push(e)}),t}}).filter("filterCommentsByUser",function(){return function(e,o,t){var n;o&&(n=o._id);var r=[];return e.forEach(function(e){(t||e.approved||e.userId===n)&&r.push(e)}),r}}).controller("PostViewController",function(e,o,t,n,r,i,a){var l=t.postId,s=e.Posts.reactiveQuery({_id:l});return s.on("change",function(){e.safeApply(function(){e.post=s.result[0]})}),e.post=s.result[0],e.post?(e.isMobile=a.isMobile(),e.bodyChildren=function(){return e.post?i.parse(e.post.body):void 0},e.estimateReadingTime=0,e.titleImageIsDisplayed=function(){return e.post?void 0!==e.post.titleImageUrl:void 0},e.isAuthor=function(){if(e.post){var o=!1;return e.user&&e.post.authors.forEach(function(t){t.userId===e.user._id&&(o=!0)}),o}},e.commentBarStatus=[],e.closeCommentBar=function(){e.commentBarIsOpen=!1,e.commentBarStatus=[]},e.openCommentBarAt=function(o){e.commentBarIsOpen=!0,e.commentBarStatus[o]=!0},e.commentBarIsOpenAt=function(o){return e.commentBarStatus[o]},e.ownsComment=function(o){return e.user?o.userId===e.user._id:void 0},e.paragraphHasComments=function(o){if(e.post){var t=r("filterCommentsByParagraph")(e.post.comments,o);if(e.isAuthor())return t.length>0;var n=r("filterCommentsByUser")(t,e.user);return n.length>0}},e.paragraphCommentsLength=function(o){if(e.post){var t=r("filterCommentsByParagraph")(e.post.comments,o);if(e.isAuthor())return t.length;var n=r("filterCommentsByUser")(t,e.user);return n.length}},e.comment={},e.deleteComment=function(o){var t=e.Ceres.call("deleteCommentFromPost",l,o._id);
t.updated.then(function(){e.post=e.Posts.db.get(l),e.$apply()})},e.publishComment=function(o){e.Ceres.call("publishCommentOfPost",l,o._id)},e.saveCommentAt=function(o){e.comment.paragraph=o,e.Ceres.call("addCommentToPost",l,e.comment),e.comment.text=""},e.setHighlight=function(e){var o=document.querySelectorAll(".first-level-html-container .simplebox")[e.paragraph],t=o.innerHTML,n='<span class="post-view-highlight">'+e.anchor+"</span>";t=t.replace(e.anchor,n),o.innerHTML=t},void(e.clearHighlight=function(e){var o=document.querySelectorAll(".first-level-html-container .simplebox")[e.paragraph],t=o.innerHTML,n='<span class="post-view-highlight">'+e.anchor+"</span>";t=t.replace(n,e.anchor),o.innerHTML=t})):void n.go("notFound")});